<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MERL-T Pipeline - Audit &amp; Explainability Tool</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --color-bg-dark: #0a0a0f;
            --color-bg-card: rgba(26, 26, 46, 0.8);
            --color-bg-card-hover: rgba(37, 37, 65, 0.9);
            --color-cyan: #00d4ff;
            --color-magenta: #ff00ff;
            --color-green: #00ff88;
            --color-pink: #ff1493;
            --color-yellow: #ffd700;
            --color-orange: #ff6b35;
            --color-text: #e0e0e0;
            --color-text-dim: #888;
            --color-border: rgba(0, 212, 255, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Space Mono', 'Courier New', monospace;
            background: var(--color-bg-dark);
            color: var(--color-text);
            line-height: 1.6;
            overflow-x: hidden;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 50%, rgba(0, 212, 255, 0.05) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(255, 0, 255, 0.05) 0%, transparent 50%),
                radial-gradient(circle at 40% 90%, rgba(0, 255, 136, 0.05) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 1;
        }

        /* Header - Hero Section */
        .header {
            position: sticky;
            top: 0;
            background: rgba(10, 10, 15, 0.95);
            backdrop-filter: blur(20px);
            padding: 40px 30px;
            border-bottom: 2px solid var(--color-cyan);
            z-index: 100;
            box-shadow: 0 4px 30px rgba(0, 212, 255, 0.3), 0 0 60px rgba(255, 0, 255, 0.2);
            text-align: center;
        }

        .header h1 {
            font-family: 'Orbitron', sans-serif;
            font-size: 3.5rem;
            font-weight: 900;
            background: linear-gradient(90deg, var(--color-cyan) 0%, var(--color-magenta) 50%, var(--color-green) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 15px;
            letter-spacing: 0.1em;
            text-shadow: 0 0 30px rgba(0, 212, 255, 0.5);
            animation: glitch 3s infinite;
        }

        @keyframes glitch {
            0%, 90%, 100% { transform: translate(0); }
            92% { transform: translate(-2px, 2px); }
            94% { transform: translate(2px, -2px); }
            96% { transform: translate(-1px, 1px); }
        }

        .header p {
            color: var(--color-cyan);
            font-size: 1rem;
            letter-spacing: 0.05em;
            text-transform: uppercase;
        }

        /* Floating Timer */
        .floating-timer {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(26, 26, 46, 0.95);
            padding: 15px 25px;
            border-radius: 10px;
            border: 2px solid var(--color-cyan);
            font-family: 'Courier New', monospace;
            font-size: 1.5rem;
            color: var(--color-cyan);
            box-shadow: 0 0 20px rgba(0, 212, 255, 0.5);
            z-index: 200;
            display: none;
        }

        .floating-timer.active {
            display: block;
            animation: glow 2s ease-in-out infinite;
        }

        @keyframes glow {
            0%, 100% { box-shadow: 0 0 20px rgba(0, 212, 255, 0.5); }
            50% { box-shadow: 0 0 30px rgba(0, 212, 255, 0.8); }
        }

        /* Examples Carousel */
        .examples-section {
            margin: 40px 0;
        }

        .section-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.8rem;
            margin-bottom: 30px;
            color: var(--color-cyan);
            border-left: 5px solid var(--color-magenta);
            padding-left: 20px;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            text-shadow: 0 0 10px rgba(0, 212, 255, 0.5);
        }

        .examples-grid {
            display: flex;
            gap: 20px;
            overflow-x: auto;
            overflow-y: hidden;
            padding: 20px 10px;
            scroll-snap-type: x mandatory;
            scroll-behavior: smooth;
            margin-bottom: 30px;
        }

        .examples-grid::-webkit-scrollbar {
            height: 8px;
        }

        .examples-grid::-webkit-scrollbar-track {
            background: rgba(0, 212, 255, 0.1);
            border-radius: 10px;
        }

        .examples-grid::-webkit-scrollbar-thumb {
            background: linear-gradient(90deg, var(--color-cyan), var(--color-magenta));
            border-radius: 10px;
        }

        .example-btn {
            flex: 0 0 280px;
            scroll-snap-align: center;
            background: var(--color-bg-card);
            backdrop-filter: blur(10px);
            border: 2px solid var(--color-border);
            border-radius: 15px;
            padding: 25px;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            text-align: left;
            position: relative;
            overflow: hidden;
        }

        .example-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 212, 255, 0.3), transparent);
            transition: left 0.5s;
        }

        .example-btn:hover::before {
            left: 100%;
        }

        .example-btn:hover {
            background: var(--color-bg-card-hover);
            border-color: var(--color-cyan);
            transform: translateY(-8px) scale(1.05);
            box-shadow: 0 10px 40px rgba(0, 212, 255, 0.4), 0 0 20px rgba(0, 212, 255, 0.3);
        }

        .example-btn.active {
            background: linear-gradient(135deg, rgba(0, 212, 255, 0.25), rgba(255, 0, 255, 0.25));
            border-color: var(--color-magenta);
            box-shadow: 0 0 30px rgba(255, 0, 255, 0.6), 0 0 60px rgba(0, 212, 255, 0.4);
            transform: scale(1.08);
        }

        .example-number {
            font-family: 'Orbitron', sans-serif;
            font-size: 2.5rem;
            font-weight: 900;
            background: linear-gradient(135deg, var(--color-cyan), var(--color-magenta));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .example-emoji {
            font-size: 2.5rem;
            margin-bottom: 10px;
            display: block;
            filter: drop-shadow(0 0 10px rgba(0, 255, 136, 0.5));
        }

        .example-title {
            font-size: 1.1rem;
            font-weight: 700;
            margin: 10px 0;
            color: var(--color-text);
            text-shadow: 0 0 5px rgba(255, 255, 255, 0.3);
        }

        .example-query-preview {
            font-size: 0.85rem;
            color: var(--color-text-dim);
            margin: 8px 0;
            line-height: 1.4;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .example-stats {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .stat-badge {
            background: rgba(0, 212, 255, 0.15);
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-family: 'Space Mono', monospace;
            border: 1px solid rgba(0, 212, 255, 0.4);
            font-weight: 700;
            transition: all 0.3s;
        }

        .stat-badge:hover {
            background: rgba(0, 212, 255, 0.3);
            box-shadow: 0 0 10px rgba(0, 212, 255, 0.5);
        }

        .stat-badge.complexity-low {
            border-color: var(--color-green);
            color: var(--color-green);
        }

        .stat-badge.complexity-medium {
            border-color: var(--color-yellow);
            color: var(--color-yellow);
        }

        .stat-badge.complexity-high {
            border-color: var(--color-pink);
            color: var(--color-pink);
        }

        /* Query Display */
        .query-display {
            background: var(--color-bg-card);
            border: 2px solid var(--color-cyan);
            border-radius: 15px;
            padding: 30px;
            margin: 30px 0;
            display: none;
        }

        .query-display.visible {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .query-text {
            font-size: 1.5rem;
            color: var(--color-green);
            margin-bottom: 20px;
            font-weight: 600;
        }

        .query-stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }

        .query-stat {
            background: rgba(0, 212, 255, 0.1);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .query-stat-label {
            font-size: 0.9rem;
            color: var(--color-text-dim);
            margin-bottom: 5px;
        }

        .query-stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--color-cyan);
            font-family: 'Courier New', monospace;
        }

        /* Control Panel */
        .control-panel {
            display: none;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin: 40px 0;
            flex-wrap: wrap;
            padding: 30px;
            background: var(--color-bg-card);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            border: 2px solid var(--color-cyan);
            box-shadow: 0 8px 32px rgba(0, 212, 255, 0.2);
        }

        .control-panel.visible {
            display: flex;
            animation: slideUp 0.5s ease;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .speed-control {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            border: 1px solid var(--color-border);
        }

        .speed-control label {
            font-size: 0.9rem;
            color: var(--color-cyan);
            font-weight: 700;
        }

        .speed-control input[type="range"] {
            width: 120px;
            height: 6px;
            background: rgba(0, 212, 255, 0.2);
            border-radius: 5px;
            outline: none;
            -webkit-appearance: none;
        }

        .speed-control input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            background: linear-gradient(135deg, var(--color-cyan), var(--color-magenta));
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 10px rgba(0, 212, 255, 0.8);
        }

        .speed-value {
            font-family: 'Space Mono', monospace;
            color: var(--color-green);
            font-weight: 700;
            min-width: 35px;
        }

        .control-btn {
            padding: 15px 30px;
            font-size: 1rem;
            font-weight: 700;
            border: 2px solid transparent;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-family: 'Space Mono', monospace;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            position: relative;
            overflow: hidden;
        }

        .control-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .control-btn:active::before {
            width: 300px;
            height: 300px;
        }

        .control-btn.start {
            background: linear-gradient(135deg, var(--color-green), #00cc70);
            color: #000;
            border-color: var(--color-green);
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.4);
        }

        .control-btn.start:hover {
            box-shadow: 0 0 30px rgba(0, 255, 136, 0.6), 0 8px 25px rgba(0, 0, 0, 0.6);
        }

        .control-btn.autoplay {
            background: linear-gradient(135deg, var(--color-cyan), #0090ff);
            color: #000;
            border-color: var(--color-cyan);
            box-shadow: 0 0 20px rgba(0, 212, 255, 0.4);
        }

        .control-btn.pause {
            background: linear-gradient(135deg, var(--color-yellow), #ffcc00);
            color: #000;
            border-color: var(--color-yellow);
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.4);
        }

        .control-btn.reset {
            background: linear-gradient(135deg, #ff4444, #cc0000);
            color: #fff;
            border-color: #ff4444;
            box-shadow: 0 0 20px rgba(255, 68, 68, 0.4);
        }

        .control-btn.skip {
            background: linear-gradient(135deg, var(--color-magenta), #cc00cc);
            color: #fff;
            border-color: var(--color-magenta);
            box-shadow: 0 0 20px rgba(255, 0, 255, 0.4);
        }

        .control-btn:hover {
            transform: scale(1.08) translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.6);
        }

        .control-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* Parallel Agents Visualization */
        .agents-container {
            display: none;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin: 30px 0;
            padding: 30px;
            background: var(--color-bg-card);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            border: 2px solid var(--color-green);
        }

        .agents-container.visible {
            display: grid;
            animation: fadeIn 0.5s ease;
        }

        .agent-card {
            background: rgba(0, 0, 0, 0.4);
            border: 2px solid var(--color-border);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .agent-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--color-cyan), var(--color-magenta), var(--color-green));
            background-size: 200% 100%;
            animation: gradientMove 2s linear infinite;
        }

        @keyframes gradientMove {
            0% { background-position: 0% 0%; }
            100% { background-position: 200% 0%; }
        }

        .agent-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
            filter: drop-shadow(0 0 10px rgba(0, 212, 255, 0.6));
        }

        .agent-name {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--color-cyan);
            margin-bottom: 15px;
            font-family: 'Orbitron', sans-serif;
        }

        .agent-progress {
            width: 100px;
            height: 100px;
            margin: 15px auto;
            position: relative;
        }

        .agent-progress-circle {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: conic-gradient(var(--color-green) 0deg, transparent 0deg);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .agent-progress-circle::before {
            content: '';
            position: absolute;
            width: 80%;
            height: 80%;
            background: var(--color-bg-dark);
            border-radius: 50%;
        }

        .agent-progress-value {
            position: relative;
            z-index: 1;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--color-green);
            font-family: 'Space Mono', monospace;
        }

        .agent-status {
            font-size: 0.85rem;
            color: var(--color-text-dim);
            margin-top: 10px;
            font-family: 'Space Mono', monospace;
        }

        /* Flow Diagram */
        .flow-diagram {
            margin: 40px 0;
            display: none;
        }

        .flow-diagram.visible {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .flow-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
            margin-bottom: 30px;
            overflow-x: auto;
            padding: 20px 0;
        }

        .flow-step {
            flex: 1;
            min-width: 150px;
            background: var(--color-bg-card);
            backdrop-filter: blur(10px);
            border: 2px solid var(--color-border);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }

        .flow-step::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 15px;
            background: radial-gradient(circle at center, rgba(0, 212, 255, 0.1), transparent);
            opacity: 0;
            transition: opacity 0.4s;
        }

        .flow-step:hover::before {
            opacity: 1;
        }

        .flow-step.active {
            border-color: var(--color-yellow);
            background: rgba(255, 215, 0, 0.15);
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.5), 0 0 60px rgba(255, 215, 0, 0.3);
            transform: scale(1.05);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% {
                box-shadow: 0 0 30px rgba(255, 215, 0, 0.5), 0 0 60px rgba(255, 215, 0, 0.3);
            }
            50% {
                box-shadow: 0 0 40px rgba(255, 215, 0, 0.7), 0 0 80px rgba(255, 215, 0, 0.5);
            }
        }

        .flow-step.complete {
            border-color: var(--color-green);
            background: rgba(0, 255, 136, 0.15);
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.4);
        }

        .flow-step.complete::after {
            content: '‚úì';
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 1.2rem;
            color: var(--color-green);
            animation: checkmark 0.5s ease;
        }

        @keyframes checkmark {
            0% {
                transform: scale(0) rotate(0deg);
                opacity: 0;
            }
            50% {
                transform: scale(1.2) rotate(180deg);
            }
            100% {
                transform: scale(1) rotate(360deg);
                opacity: 1;
            }
        }

        .flow-step-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--color-text-dim);
            font-family: 'Space Mono', monospace;
            transition: all 0.3s;
        }

        .flow-step.active .flow-step-number {
            color: var(--color-yellow);
        }

        .flow-step.complete .flow-step-number {
            color: var(--color-green);
        }

        .flow-step-name {
            font-size: 0.95rem;
            font-weight: 700;
            margin-top: 12px;
            color: var(--color-text);
            font-family: 'Space Mono', monospace;
        }

        .flow-arrow {
            font-size: 2rem;
            color: var(--color-cyan);
        }

        /* Progress Bar */
        .progress-section {
            margin: 30px 0;
            display: none;
        }

        .progress-section.visible {
            display: block;
        }

        .progress-bar-container {
            width: 100%;
            height: 30px;
            background: var(--color-bg-card);
            border: 2px solid var(--color-cyan);
            border-radius: 15px;
            overflow: hidden;
            position: relative;
        }

        .progress-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--color-cyan), var(--color-magenta));
            width: 0%;
            transition: width 0.5s ease;
            position: relative;
        }

        .progress-bar-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* Step Details */
        .step-details {
            margin: 20px 0;
        }

        .step-container {
            background: var(--color-bg-card);
            border: 2px solid var(--color-border);
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 20px;
            display: none;
        }

        .step-container.visible {
            display: block;
            animation: slideIn 0.5s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .step-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .step-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--color-cyan);
        }

        .step-status {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .step-status.processing {
            background: rgba(255, 215, 0, 0.2);
            color: var(--color-yellow);
            border: 1px solid var(--color-yellow);
        }

        .step-status.complete {
            background: rgba(0, 255, 136, 0.2);
            color: var(--color-green);
            border: 1px solid var(--color-green);
        }

        .step-description {
            color: var(--color-text-dim);
            margin-bottom: 15px;
        }

        .substep-list {
            list-style: none;
        }

        .substep-item {
            padding: 10px;
            margin: 5px 0;
            background: rgba(0, 212, 255, 0.05);
            border-left: 3px solid var(--color-cyan);
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            opacity: 0;
            animation: fadeIn 0.5s ease forwards;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Metrics Dashboard */
        .metrics-dashboard {
            margin: 40px 0;
            display: none;
        }

        .metrics-dashboard.visible {
            display: block;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .metric-card {
            background: var(--color-bg-card);
            border: 2px solid var(--color-border);
            border-radius: 10px;
            padding: 25px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .metric-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 212, 255, 0.3);
        }

        .metric-label {
            font-size: 0.9rem;
            color: var(--color-text-dim);
            margin-bottom: 10px;
        }

        .metric-value {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--color-cyan);
            font-family: 'Courier New', monospace;
        }

        .metric-unit {
            font-size: 1rem;
            color: var(--color-text-dim);
            margin-left: 5px;
        }

        /* Loop Visualization */
        .loop-indicator {
            display: none;
            margin: 30px 0;
            padding: 25px;
            background: var(--color-bg-card);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            border: 2px solid var(--color-orange);
            box-shadow: 0 0 30px rgba(255, 107, 53, 0.4);
        }

        .loop-indicator.visible {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .loop-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .loop-icon {
            font-size: 2rem;
            animation: rotate 2s linear infinite;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .loop-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.5rem;
            color: var(--color-orange);
            font-weight: 700;
        }

        .loop-reason {
            color: var(--color-text-dim);
            font-size: 0.95rem;
            line-height: 1.6;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            border-left: 4px solid var(--color-orange);
        }

        /* Experts Consensus */
        .experts-panel {
            display: none;
            margin: 30px 0;
        }

        .experts-panel.visible {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .experts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .expert-card {
            background: var(--color-bg-card);
            backdrop-filter: blur(10px);
            border: 2px solid var(--color-border);
            border-radius: 15px;
            padding: 25px;
            transition: all 0.3s;
        }

        .expert-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(255, 0, 255, 0.3);
            border-color: var(--color-magenta);
        }

        .expert-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .expert-name {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--color-magenta);
        }

        .expert-confidence {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--color-green);
            font-family: 'Space Mono', monospace;
        }

        .expert-reasoning {
            color: var(--color-text-dim);
            font-size: 0.9rem;
            line-height: 1.6;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            max-height: 120px;
            overflow-y: auto;
        }

        .expert-reasoning::-webkit-scrollbar {
            width: 6px;
        }

        .expert-reasoning::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
        }

        .expert-reasoning::-webkit-scrollbar-thumb {
            background: var(--color-magenta);
            border-radius: 10px;
        }

        /* Final Result */
        .final-result {
            background: linear-gradient(135deg, rgba(0, 255, 136, 0.1), rgba(0, 212, 255, 0.1));
            border: 3px solid var(--color-green);
            border-radius: 15px;
            padding: 40px;
            margin: 40px 0;
            display: none;
        }

        .final-result.visible {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .result-header {
            font-size: 2rem;
            color: var(--color-green);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .result-conclusion {
            font-size: 1.5rem;
            color: var(--color-text);
            font-weight: 600;
            margin: 20px 0;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            border-left: 4px solid var(--color-magenta);
        }

        .result-section {
            margin: 25px 0;
        }

        .result-section-title {
            font-size: 1.2rem;
            color: var(--color-cyan);
            margin-bottom: 15px;
            font-weight: 600;
        }

        .experts-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .expert-badge {
            background: rgba(255, 0, 255, 0.2);
            border: 1px solid var(--color-magenta);
            padding: 8px 15px;
            border-radius: 20px;
            color: var(--color-magenta);
            font-size: 0.9rem;
            font-weight: 600;
        }

        .key-points-list {
            list-style: none;
        }

        .key-point {
            padding: 15px;
            margin: 10px 0;
            background: rgba(0, 212, 255, 0.05);
            border-left: 4px solid var(--color-cyan);
            border-radius: 5px;
        }

        .result-metadata {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 30px;
            padding-top: 30px;
            border-top: 2px solid var(--color-border);
        }

        .metadata-item {
            text-align: center;
        }

        .metadata-label {
            font-size: 0.85rem;
            color: var(--color-text-dim);
            margin-bottom: 5px;
        }

        .metadata-value {
            font-size: 1.3rem;
            color: var(--color-cyan);
            font-weight: bold;
            font-family: 'Courier New', monospace;
        }

        /* Sidebar Navigation */
        .sidebar {
            position: fixed;
            left: 0;
            top: 180px;
            width: 280px;
            height: calc(100% - 180px);
            background: rgba(26, 26, 46, 0.95);
            backdrop-filter: blur(20px);
            border-right: 2px solid var(--color-cyan);
            overflow-y: auto;
            z-index: 90;
            padding: 20px;
            transition: transform 0.3s;
        }

        .sidebar.collapsed {
            transform: translateX(-280px);
        }

        .sidebar-toggle {
            position: fixed;
            left: 280px;
            top: 200px;
            background: var(--color-cyan);
            color: #000;
            border: none;
            padding: 10px;
            cursor: pointer;
            z-index: 91;
            border-radius: 0 8px 8px 0;
            transition: left 0.3s;
        }

        .sidebar.collapsed + .sidebar-toggle {
            left: 0;
        }

        .nav-tree {
            list-style: none;
        }

        .nav-item {
            margin: 10px 0;
            padding: 10px;
            background: rgba(0, 212, 255, 0.1);
            border-left: 3px solid var(--color-cyan);
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9rem;
        }

        .nav-item:hover {
            background: rgba(0, 212, 255, 0.2);
            transform: translateX(5px);
        }

        .nav-item.active {
            background: rgba(0, 212, 255, 0.3);
            border-left-color: var(--color-magenta);
            box-shadow: 0 0 10px rgba(0, 212, 255, 0.5);
        }

        .nav-item.completed {
            border-left-color: var(--color-green);
        }

        .nav-substeps {
            list-style: none;
            margin-top: 8px;
            padding-left: 15px;
            display: none;
        }

        .nav-item.active .nav-substeps,
        .nav-item.completed .nav-substeps {
            display: block;
        }

        .nav-substep {
            font-size: 0.8rem;
            color: var(--color-text-dim);
            padding: 5px 0;
            cursor: pointer;
        }

        .nav-substep:hover {
            color: var(--color-cyan);
        }

        /* Main Content Area */
        .main-content {
            margin-left: 300px;
            margin-right: 420px;
            padding: 20px;
            transition: margin-left 0.3s;
        }

        .sidebar.collapsed ~ .container .main-content {
            margin-left: 20px;
        }

        /* Right Panel - JSON/Data View */
        .right-panel {
            position: fixed;
            right: 0;
            top: 180px;
            width: 400px;
            height: calc(100% - 180px);
            background: rgba(26, 26, 46, 0.95);
            backdrop-filter: blur(20px);
            border-left: 2px solid var(--color-magenta);
            overflow-y: auto;
            z-index: 90;
            padding: 20px;
        }

        .panel-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid var(--color-border);
        }

        .panel-tab {
            padding: 10px 15px;
            background: transparent;
            border: none;
            color: var(--color-text-dim);
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.3s;
            font-family: 'Space Mono', monospace;
        }

        .panel-tab.active {
            color: var(--color-cyan);
            border-bottom-color: var(--color-cyan);
        }

        .panel-content {
            display: none;
        }

        .panel-content.active {
            display: block;
        }

        .json-viewer {
            background: rgba(0, 0, 0, 0.4);
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            line-height: 1.6;
            overflow-x: auto;
            border: 1px solid var(--color-border);
        }

        .json-key {
            color: var(--color-cyan);
        }

        .json-string {
            color: var(--color-green);
        }

        .json-number {
            color: var(--color-yellow);
        }

        .json-boolean {
            color: var(--color-magenta);
        }

        /* Progress Indicator */
        .progress-indicator {
            margin-top: 15px;
            font-size: 1.2rem;
            color: var(--color-yellow);
            font-family: 'Orbitron', sans-serif;
        }

        /* Step Section */
        .step-section {
            background: var(--color-bg-card);
            border: 2px solid var(--color-border);
            border-radius: 15px;
            padding: 30px;
            margin: 20px 0;
            display: none;
        }

        .step-section.visible {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .step-header-main {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--color-border);
        }

        .step-title-main {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.8rem;
            color: var(--color-cyan);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .step-badge {
            background: linear-gradient(135deg, var(--color-cyan), var(--color-magenta));
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 1rem;
            color: #000;
            font-weight: 700;
        }

        /* Sub-stage Panel */
        .substage-panel {
            background: rgba(0, 0, 0, 0.3);
            border-left: 4px solid var(--color-cyan);
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
        }

        .substage-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            user-select: none;
        }

        .substage-title {
            font-size: 1.2rem;
            color: var(--color-green);
            font-weight: 600;
        }

        .substage-content {
            margin-top: 15px;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .substage-panel.expanded .substage-content {
            max-height: 2000px;
        }

        .expand-icon {
            transition: transform 0.3s;
        }

        .substage-panel.expanded .expand-icon {
            transform: rotate(180deg);
        }

        /* Entity Highlight */
        .entity-highlight {
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: 600;
            margin: 0 2px;
        }

        .entity-person {
            background: rgba(59, 130, 246, 0.3);
            color: #3b82f6;
            border: 1px solid #3b82f6;
        }

        .entity-legalobject {
            background: rgba(0, 255, 136, 0.3);
            color: var(--color-green);
            border: 1px solid var(--color-green);
        }

        .entity-action {
            background: rgba(255, 107, 53, 0.3);
            color: var(--color-orange);
            border: 1px solid var(--color-orange);
        }

        .entity-temporal {
            background: rgba(255, 68, 68, 0.3);
            color: #ff4444;
            border: 1px solid #ff4444;
        }

        /* Table Styles */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            font-size: 0.9rem;
        }

        .data-table th {
            background: rgba(0, 212, 255, 0.2);
            color: var(--color-cyan);
            padding: 12px;
            text-align: left;
            font-weight: 600;
            border-bottom: 2px solid var(--color-cyan);
        }

        .data-table td {
            padding: 10px 12px;
            border-bottom: 1px solid var(--color-border);
            color: var(--color-text);
        }

        .data-table tr:hover {
            background: rgba(0, 212, 255, 0.05);
        }

        /* Gauge/Circle Progress */
        .gauge-container {
            display: flex;
            justify-content: center;
            margin: 20px 0;
        }

        .gauge {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: conic-gradient(var(--color-green) 0deg, var(--color-yellow) 180deg, var(--color-pink) 360deg);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            box-shadow: 0 0 30px rgba(0, 212, 255, 0.4);
        }

        .gauge::before {
            content: '';
            position: absolute;
            width: 85%;
            height: 85%;
            background: var(--color-bg-dark);
            border-radius: 50%;
        }

        .gauge-value {
            position: relative;
            z-index: 1;
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--color-cyan);
            font-family: 'Space Mono', monospace;
        }

        /* Bottom Timeline */
        .bottom-timeline {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 80px;
            background: rgba(26, 26, 46, 0.95);
            backdrop-filter: blur(20px);
            border-top: 2px solid var(--color-cyan);
            z-index: 95;
            display: flex;
            align-items: center;
            padding: 0 20px;
            overflow-x: auto;
        }

        .timeline-step {
            flex: 1;
            min-width: 120px;
            text-align: center;
            padding: 10px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }

        .timeline-step::after {
            content: '';
            position: absolute;
            top: 50%;
            right: -10px;
            width: 20px;
            height: 2px;
            background: var(--color-border);
        }

        .timeline-step:last-child::after {
            display: none;
        }

        .timeline-step-icon {
            font-size: 1.5rem;
            margin-bottom: 5px;
            filter: grayscale(1);
            opacity: 0.5;
            transition: all 0.3s;
        }

        .timeline-step.completed .timeline-step-icon {
            filter: grayscale(0);
            opacity: 1;
        }

        .timeline-step.active .timeline-step-icon {
            filter: grayscale(0);
            opacity: 1;
            animation: pulse 2s infinite;
        }

        .timeline-step-name {
            font-size: 0.75rem;
            color: var(--color-text-dim);
        }

        .timeline-step.completed .timeline-step-name,
        .timeline-step.active .timeline-step-name {
            color: var(--color-cyan);
        }

        /* Copy Button */
        .copy-btn {
            background: var(--color-cyan);
            color: #000;
            border: none;
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-family: 'Space Mono', monospace;
            font-weight: 600;
            transition: all 0.3s;
            margin-top: 10px;
        }

        .copy-btn:hover {
            background: var(--color-green);
            box-shadow: 0 0 15px rgba(0, 255, 136, 0.5);
        }

        /* Concept Node Visualization */
        .concept-viz {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 15px 0;
        }

        .concept-node {
            background: rgba(0, 212, 255, 0.2);
            border: 2px solid var(--color-cyan);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            transition: all 0.3s;
        }

        .concept-node.excluded {
            background: rgba(255, 68, 68, 0.2);
            border-color: #ff4444;
            opacity: 0.6;
            text-decoration: line-through;
        }

        .concept-node:hover {
            transform: scale(1.05);
            box-shadow: 0 0 15px rgba(0, 212, 255, 0.5);
        }

        /* Bar Chart */
        .bar-chart {
            margin: 20px 0;
        }

        .bar-item {
            margin: 10px 0;
        }

        .bar-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }

        .bar-fill-container {
            width: 100%;
            height: 30px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 5px;
            overflow: hidden;
        }

        .bar-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--color-cyan), var(--color-magenta));
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 10px;
            color: #fff;
            font-weight: 600;
            font-size: 0.85rem;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8rem;
            }

            .sidebar {
                transform: translateX(-280px);
            }

            .main-content {
                margin-left: 20px;
                margin-right: 20px;
            }

            .right-panel {
                display: none;
            }

            .floating-timer {
                top: 10px;
                right: 10px;
                font-size: 1.2rem;
                padding: 10px 15px;
            }

            .bottom-timeline {
                padding-bottom: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="floating-timer" id="timer">00:00.000</div>

    <div class="header">
        <h1>MERL-T PIPELINE AUDIT</h1>
        <p>Legal Reasoning Explainability &amp; Understanding Tool</p>
        <div class="progress-indicator" id="progressIndicator">Step <span id="currentStepNum">0</span>/8</div>
    </div>

    <!-- Sidebar Navigation -->
    <div class="sidebar" id="sidebar">
        <ul class="nav-tree" id="navTree"></ul>
    </div>
    <button class="sidebar-toggle" id="sidebarToggle">‚ò∞</button>

    <!-- Right Panel -->
    <div class="right-panel" id="rightPanel">
        <div class="panel-tabs">
            <button class="panel-tab active" data-tab="json">JSON</button>
            <button class="panel-tab" data-tab="logs">Logs</button>
            <button class="panel-tab" data-tab="trace">Trace</button>
        </div>
        <div class="panel-content active" id="jsonPanel">
            <div class="json-viewer" id="jsonViewer"></div>
        </div>
        <div class="panel-content" id="logsPanel">
            <div class="json-viewer" id="logsViewer"></div>
        </div>
        <div class="panel-content" id="tracePanel">
            <div class="json-viewer" id="traceViewer"></div>
        </div>
    </div>

    <!-- Bottom Timeline -->
    <div class="bottom-timeline" id="bottomTimeline"></div>

    <div class="container">
        <div class="main-content">
        <!-- Examples Section -->
        <section class="examples-section">
            <h2 class="section-title">Seleziona un Esempio</h2>
            <div class="examples-grid" id="examplesGrid"></div>
        </section>

        <!-- Query Display -->
        <section class="query-display" id="queryDisplay">
            <div class="query-text" id="queryText"></div>
            <div class="query-stats-grid" id="queryStats"></div>
        </section>

        <!-- Control Panel -->
        <section class="control-panel" id="controlPanel">
            <button class="control-btn start" id="startBtn">‚ñ∂ Avvia</button>
            <button class="control-btn pause" id="pauseBtn" disabled>‚è∏ Pausa</button>
            <button class="control-btn reset" id="resetBtn">‚Ü∫ Reset</button>
            <button class="control-btn skip" id="skipBtn">‚è≠ Skip</button>
            <button class="control-btn autoplay" id="autoplayBtn">üé¨ Auto</button>
            <div class="speed-control">
                <label>Speed:</label>
                <input type="range" id="speedSlider" min="0.5" max="2" step="0.1" value="1">
                <span class="speed-value" id="speedValue">1x</span>
            </div>
        </section>

        <!-- Parallel Agents (shown during step 4) -->
        <section class="agents-container" id="agentsContainer">
            <div class="agent-card">
                <div class="agent-icon">üóÑÔ∏è</div>
                <div class="agent-name">KG Agent</div>
                <div class="agent-progress">
                    <div class="agent-progress-circle" id="kgProgress">
                        <span class="agent-progress-value" id="kgValue">0%</span>
                    </div>
                </div>
                <div class="agent-status" id="kgStatus">Querying Knowledge Graph...</div>
            </div>
            <div class="agent-card">
                <div class="agent-icon">üîå</div>
                <div class="agent-name">API Agent</div>
                <div class="agent-progress">
                    <div class="agent-progress-circle" id="apiProgress">
                        <span class="agent-progress-value" id="apiValue">0%</span>
                    </div>
                </div>
                <div class="agent-status" id="apiStatus">Fetching from legal APIs...</div>
            </div>
            <div class="agent-card">
                <div class="agent-icon">üîç</div>
                <div class="agent-name">VectorDB Agent</div>
                <div class="agent-progress">
                    <div class="agent-progress-circle" id="vectorProgress">
                        <span class="agent-progress-value" id="vectorValue">0%</span>
                    </div>
                </div>
                <div class="agent-status" id="vectorStatus">Similarity search...</div>
            </div>
        </section>

        <!-- Loop Indicator (shown during iterations) -->
        <section class="loop-indicator" id="loopIndicator">
            <div class="loop-header">
                <span class="loop-icon">üîÑ</span>
                <span class="loop-title">Iterazione Rilevata</span>
            </div>
            <div class="loop-reason" id="loopReason"></div>
        </section>

        <!-- Experts Panel (shown during step 5) -->
        <section class="experts-panel" id="expertsPanel">
            <h2 class="section-title">Reasoning Experts Consensus</h2>
            <div class="experts-grid" id="expertsGrid"></div>
        </section>

        <!-- Flow Diagram -->
        <section class="flow-diagram" id="flowDiagram">
            <h2 class="section-title">Pipeline Flow</h2>
            <div class="flow-container" id="flowContainer"></div>
        </section>

        <!-- Progress Bar -->
        <section class="progress-section" id="progressSection">
            <h2 class="section-title">Progresso Simulazione</h2>
            <div class="progress-bar-container">
                <div class="progress-bar-fill" id="progressBar"></div>
            </div>
        </section>

        <!-- Step Details -->
        <section class="step-details" id="stepDetails"></section>

        <!-- Metrics Dashboard -->
        <section class="metrics-dashboard" id="metricsDashboard">
            <h2 class="section-title">Metriche Pipeline</h2>
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-label">Latenza Totale</div>
                    <div class="metric-value" id="metricLatency">0<span class="metric-unit">ms</span></div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Iterazioni</div>
                    <div class="metric-value" id="metricIterations">0</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Confidence Score</div>
                    <div class="metric-value" id="metricConfidence">0<span class="metric-unit">%</span></div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Token LLM</div>
                    <div class="metric-value" id="metricTokens">0</div>
                </div>
            </div>
        </section>

        <!-- Step Details -->
        <section id="stepSections"></section>

        <!-- Final Result -->
        <section class="final-result" id="finalResult">
            <div class="result-header">
                <span>‚úÖ</span>
                <span>RISPOSTA FINALE GENERATA</span>
            </div>
            <div class="result-conclusion" id="resultConclusion"></div>
            
            <div class="result-section">
                <div class="result-section-title">Esperti Utilizzati</div>
                <div class="experts-list" id="expertsList"></div>
            </div>

            <div class="result-section">
                <div class="result-section-title">Punti Chiave</div>
                <ul class="key-points-list" id="keyPointsList"></ul>
            </div>

            <div class="result-metadata" id="resultMetadata"></div>
        </section>
        </div><!-- end main-content -->
    </div>

    <script>
        // Full Data from YAML
        const examplesData = {
            "1": {
                id: 1,
                numero: 1,
                titolo: "Contratto Minorenne",
                emoji: "üë∂",
                query: "√à valido un contratto firmato da un sedicenne?",
                query_understanding: {
                    abbreviation_expansion: [
                        { token: "contratto", expanded: "contratto civile", confidence: 0.98, rlcf_feedback: null }
                    ],
                    entity_extraction: [
                        { token: "sedicenne", type: "PERSON", value: "16", pos_tag: "ADJ", confidence: 0.94 },
                        { token: "contratto", type: "LEGALOBJECT", value: "contratto", pos_tag: "NOUN", confidence: 0.96 }
                    ],
                    concept_mapping: {
                        candidates: ["contratto", "capacit√†", "minore", "validit√†"],
                        approved: ["capacit√†_di_agire", "validit√†_contrattuale", "minore_et√†", "annullabilit√†"],
                        excluded: [{concept: "contratto", reason: "Generic: excluded per complexity > 0.8", confidence: 0.72}]
                    },
                    intent_classification: [
                        { intent: "validit√†_atto", probability: 0.94, ranking: 1, selected: true }
                    ],
                    temporal_extraction: {
                        temporal_scope: "current",
                        range: null,
                        default_used: true
                    },
                    complexity_scoring: {
                        entity_count: 0.25,
                        intent_complexity: 0.18,
                        temporal_constraints: 0,
                        specificity: -0.15,
                        final: 0.62,
                        formula: "0.25 + 0.18 + 0 - 0.15 = 0.62"
                    }
                },
                kg_enrichment: {
                    cypher_queries: [
                        { query: "MATCH (c:Concept)-[:REGULATED_BY]->(n:Norm) WHERE c.name IN ['capacit√†_di_agire', 'validit√†_contrattuale'] RETURN n", results: 8, time_ms: 47 }
                    ],
                    mapped_norms: [
                        { id: "cc-art-2", title: "Maggiore et√†", version: "current", fulltext: "La maggiore et√† si consegue col compimento del diciottesimo anno.", related_concepts: ["capacit√†_di_agire"] },
                        { id: "cc-art-322", title: "Annullabilit√† atti minore", version: "current", related_concepts: ["annullabilit√†"] }
                    ],
                    jurisprudence: [
                        { id: "Cass. 18210/2015", court: "Cassazione", authority_score: 0.95, citations: 247, abstract: "Gli atti compiuti da minore senza rappresentanza sono annullabili..." },
                        { id: "Cass. 3281/2019", court: "Cassazione", authority_score: 0.92, citations: 89 }
                    ],
                    related_concepts_depth2: {
                        depth1: ["emancipazione", "rappresentanza_legale"],
                        depth2: ["autorizzazione_matrimonio", "capacit√†_di_agire_limitata"]
                    }
                },
                router: {
                    expert_selection: [
                        { expert: "Literal Interpreter", confidence: 0.92, reason: "Query richiede interpretazione letterale Art. 2, 322" },
                        { expert: "Precedent Expert", confidence: 0.88, reason: "Giurisprudenza consolidata su capacit√† minore" }
                    ],
                    retrieval_agents: ["KG Agent", "API Agent"],
                    expected_iterations: 1,
                    router_confidence: 0.92
                },
                retrieval: {
                    kg_agent: { query_time_ms: 52, results: 12, cache_status: "hit", norms_retrieved: ["cc-art-2", "cc-art-322", "cc-art-1425"] },
                    api_agent: { requests: 3, responses: 3, status: 200, time_ms: 156, fallback: false },
                    vectordb_agent: { topk: 5, query_time_ms: 89, results: 5, similarity_scores: [0.94, 0.91, 0.87, 0.82, 0.79] },
                    aggregated_timeline: [
                        { time_ms: 52, agent: "KG Agent", status: "completed" },
                        { time_ms: 89, agent: "VectorDB Agent", status: "completed" },
                        { time_ms: 156, agent: "API Agent", status: "completed" }
                    ]
                },
                reasoning: {
                    experts: [
                        {
                            name: "Literal Interpreter",
                            method: "letterale",
                            steps: [
                                { step: 1, description: "Art. 2 c.c.: maggiore et√† al 18¬∞ anno", evidence: "Norma: cc-art-2", confidence_update: 0.85 },
                                { step: 2, description: "Sedicenne = 16 anni = minore", evidence: "Interpretazione letterale", confidence_update: 0.89 },
                                { step: 3, description: "Art. 322: atti minore annullabili", evidence: "Norma: cc-art-322", confidence_update: 0.92 }
                            ],
                            verdict: "ANNULLABILE",
                            confidence: 0.92,
                            sources: ["cc-art-2", "cc-art-322"]
                        },
                        {
                            name: "Precedent Expert",
                            method: "jurisprudenza",
                            steps: [
                                { step: 1, description: "Cass. 18210/2015: annullabilit√† atti minore senza rappresentanza", evidence: "Precedente: Cass. 18210/2015", confidence_update: 0.88 },
                                { step: 2, description: "Applicazione diretta al caso: contratto firmato senza genitori", evidence: "Reasoning analogico", confidence_update: 0.88 }
                            ],
                            verdict: "ANNULLABILE",
                            confidence: 0.88,
                            sources: ["Cass. 18210/2015"]
                        }
                    ],
                    consensus: { divergence: 0.04, confidence_avg: 0.90, convergence_status: "CONVERGED", consensus_verdict: "ANNULLABILE" }
                },
                loop_controller: {
                    metrics: [
                        { metric: "confidence_avg", threshold: 0.85, actual: 0.90, status: "PASS" },
                        { metric: "divergence_max", threshold: 0.15, actual: 0.04, status: "PASS" }
                    ],
                    decision: "STOP",
                    rationale: "Confidenza media >0.90, divergenza <0.15 ‚Üí criterio soddisfatto",
                    iterations: 1
                },
                synthesis: {
                    mode: "convergent",
                    weights: [
                        { expert: "Literal Interpreter", weight: 0.52, confidence: 0.92, contribution: 0.478 },
                        { expert: "Precedent Expert", weight: 0.48, confidence: 0.88, contribution: 0.422 }
                    ],
                    formula: "0.52 √ó 0.92 + 0.48 √ó 0.88 = 0.938",
                    final_conclusion: "Contratto ANNULLABILE (Art. 2, 322 c.c.)",
                    final_confidence: 0.938,
                    key_points: [
                        "Maggiore et√†: 18 anni (Art. 2 c.c.)",
                        "Minore privo capacit√† agire ‚Üí atti annullabili (Art. 322)",
                        "Annullabilit√† su istanza rappresentante legale",
                        "Ratifica possibile al raggiungimento maggiore et√†"
                    ],
                    caveats: [
                        { text: "Emancipazione (Art. 390) potrebbe consentire validit√† in casi specifici", severity: "LOW" }
                    ],
                    sources: [
                        { type: "norm", id: "cc-art-2", title: "Maggiore et√†", citations: 1247, relevance: 0.98 },
                        { type: "norm", id: "cc-art-322", title: "Annullabilit√† atti minore", citations: 892, relevance: 0.97 },
                        { type: "precedent", id: "Cass. 18210/2015", citations: 247, relevance: 0.95 }
                    ]
                },
                traceability: {
                    execution_time_ms: 3847,
                    total_tokens: 6521,
                    model_versions: {
                        query_understanding: "distilbert-it-legal v2.3",
                        router: "RLCF v5.1",
                        reasoning: "GPT-4 Turbo"
                    },
                    compliance: [
                        { feature: "Entity Privacy", standard: "GDPR", status: "compliant", details: "Nessun dato personale identifiable estratto" },
                        { feature: "Audit Trail", standard: "ISO 27001", status: "compliant", details: "Full trace disponibile" }
                    ],
                    feedback_history: [
                        { date: "2025-11-01", feedback: "Accuracy correct", impact: "+0.5% accuracy" }
                    ]
                },
                export: {
                    available_formats: ["JSON", "Markdown", "PDF", "CSV"]
                }
            },
            "2": {
                id: 2,
                numero: 2,
                titolo: "Licenziamento Donna Incinta",
                emoji: "ü§∞",
                query: "√à legale licenziare una donna incinta?",
                query_understanding: {
                    abbreviation_expansion: [
                        { token: "licenziare", expanded: "licenziamento individuale", confidence: 0.97 }
                    ],
                    entity_extraction: [
                        { token: "donna incinta", type: "PERSON", value: "lavoratrice_gravidanza", pos_tag: "NOUN", confidence: 0.96 },
                        { token: "licenziare", type: "ACTION", value: "licenziamento", pos_tag: "VERB", confidence: 0.95 }
                    ],
                    concept_mapping: {
                        candidates: ["licenziamento", "gravidanza", "tutela", "lavoro"],
                        approved: ["tutela_maternit√†", "divieto_licenziamento", "discriminazione"],
                        excluded: []
                    },
                    intent_classification: [
                        { intent: "legittimit√†_atto", probability: 0.96, ranking: 1, selected: true }
                    ],
                    temporal_extraction: { temporal_scope: "current", range: null, default_used: true },
                    complexity_scoring: {
                        entity_count: 0.30,
                        intent_complexity: 0.25,
                        temporal_constraints: 0,
                        specificity: 0.20,
                        final: 0.75,
                        formula: "0.30 + 0.25 + 0 + 0.20 = 0.75"
                    }
                },
                kg_enrichment: {
                    cypher_queries: [
                        { query: "MATCH (c:Concept)-[:REGULATED_BY]->(n:Norm) WHERE c.name IN ['tutela_maternit√†', 'divieto_licenziamento'] RETURN n", results: 5, time_ms: 38 }
                    ],
                    mapped_norms: [
                        { 
                            id: "dlgs-151-2001-art-54", 
                            title: "Divieto di licenziamento", 
                            version: "current", 
                            fulltext: "Le lavoratrici non possono essere licenziate dall'inizio del periodo di gravidanza fino al termine dei periodi di interdizione dal lavoro previsti dal Capo III, nonch√© fino al compimento di un anno di et√† del bambino. Il divieto di licenziamento opera in connessione con lo stato oggettivo di gravidanza, e la lavoratrice, licenziata nel corso del periodo in cui opera il divieto, √® tenuta a presentare al datore di lavoro idonea certificazione dalla quale risulti l'esistenza all'epoca del licenziamento, delle condizioni che lo vietavano.",
                            link: "https://www.normattiva.it/uri-res/N2Ls?urn:nir:stato:decreto.legislativo:2001-03-26;151~art54",
                            related_concepts: ["tutela_maternit√†", "divieto_licenziamento"]
                        },
                        { 
                            id: "cost-art-37", 
                            title: "Tutela del lavoro femminile", 
                            version: "current", 
                            fulltext: "La donna lavoratrice ha gli stessi diritti e, a parit√† di lavoro, le stesse retribuzioni che spettano al lavoratore. Le condizioni di lavoro devono consentire l'adempimento della sua essenziale funzione familiare e assicurare alla madre e al bambino una speciale adeguata protezione.",
                            related_concepts: ["tutela_lavoro_femminile", "protezione_maternit√†"]
                        }
                    ],
                    jurisprudence: [
                        { 
                            id: "Cass. 24015/2019", 
                            court: "Cassazione", 
                            date: "2019",
                            authority_score: 0.97, 
                            citations: 156, 
                            abstract: "Licenziamento donna gravidanza = NULLO (Art. 54 D.Lgs. 151/2001), diritto reintegrazione + risarcimento danno. La nullit√† opera anche se datore non conosceva stato gravidanza."
                        }
                    ],
                    related_concepts_depth2: {
                        depth1: ["reintegrazione", "risarcimento_danno"],
                        depth2: ["giusta_causa", "tutela_costituzionale"]
                    }
                },
                router: {
                    expert_selection: [
                        { expert: "Literal Interpreter", confidence: 0.95, reason: "Interpretazione letterale Art. 54 D.Lgs. 151/2001" },
                        { expert: "Systemic Expert", confidence: 0.88, reason: "Coordinamento con Art. 2119 c.c. (giusta causa)" },
                        { expert: "Constitutional Expert", confidence: 0.91, reason: "Art. 37 Cost.: tutela speciale maternit√†" }
                    ],
                    retrieval_agents: ["KG Agent", "API Agent", "VectorDB Agent"],
                    expected_iterations: 1,
                    router_confidence: 0.93
                },
                retrieval: {
                    kg_agent: { query_time_ms: 38, results: 9, cache_status: "miss", norms_retrieved: ["dlgs-151-2001-art-54", "cost-art-37"] },
                    api_agent: { requests: 2, responses: 2, status: 200, time_ms: 142, fallback: false },
                    vectordb_agent: { topk: 5, query_time_ms: 76, results: 5, similarity_scores: [0.97, 0.93, 0.89, 0.84, 0.81] },
                    aggregated_timeline: [
                        { time_ms: 38, agent: "KG Agent", status: "completed" },
                        { time_ms: 76, agent: "VectorDB Agent", status: "completed" },
                        { time_ms: 142, agent: "API Agent", status: "completed" }
                    ]
                },
                reasoning: {
                    experts: [
                        {
                            name: "Literal Interpreter",
                            method: "letterale",
                            steps: [
                                { step: 1, description: "Art. 54 D.Lgs. 151/2001 comma 1: 'Non possono essere licenziate dall'inizio della gravidanza fino a 1 anno et√† bambino'", evidence: "Norma: dlgs-151-2001-art-54", confidence_update: 0.92 },
                                { step: 2, description: "Divieto assoluto: licenziamento = NULLO (non annullabile)", evidence: "Interpretazione letterale Art. 54", confidence_update: 0.95 }
                            ],
                            verdict: "NULLO",
                            confidence: 0.95,
                            sources: ["dlgs-151-2001-art-54"]
                        },
                        {
                            name: "Systemic Expert",
                            method: "sistematico",
                            steps: [
                                { step: 1, description: "Coordinamento Art. 54 (divieto) + Art. 2119 c.c. (giusta causa)", evidence: "Sistema coordinato", confidence_update: 0.85 },
                                { step: 2, description: "Eccezione: giusta causa per gravi inadempienze lavoratrice", evidence: "Giurisprudenza consolidata", confidence_update: 0.88 }
                            ],
                            verdict: "NULLO salvo giusta causa",
                            confidence: 0.88,
                            sources: ["dlgs-151-2001-art-54", "cc-art-2119"]
                        },
                        {
                            name: "Constitutional Expert",
                            method: "costituzionale",
                            steps: [
                                { step: 1, description: "Art. 37 Cost.: protezione speciale lavoro femminile e maternit√†", evidence: "Norma: cost-art-37", confidence_update: 0.91 },
                                { step: 2, description: "Tutela costituzionale prevalente su autonomia contrattuale", evidence: "Principio costituzionale", confidence_update: 0.91 }
                            ],
                            verdict: "NULLO - Tutela costituzionale",
                            confidence: 0.91,
                            sources: ["cost-art-37"]
                        }
                    ],
                    consensus: { divergence: 0.07, confidence_avg: 0.913, convergence_status: "CONVERGED", consensus_verdict: "NULLO" }
                },
                loop_controller: {
                    metrics: [
                        { metric: "confidence_avg", threshold: 0.85, actual: 0.913, status: "PASS" },
                        { metric: "divergence_max", threshold: 0.15, actual: 0.07, status: "PASS" }
                    ],
                    decision: "STOP",
                    rationale: "Confidenza alta (0.913), convergenza raggiunta",
                    iterations: 1
                },
                synthesis: {
                    mode: "convergent",
                    weights: [
                        { expert: "Literal Interpreter", weight: 0.38, confidence: 0.95, contribution: 0.361 },
                        { expert: "Systemic Expert", weight: 0.30, confidence: 0.88, contribution: 0.264 },
                        { expert: "Constitutional Expert", weight: 0.32, confidence: 0.91, contribution: 0.291 }
                    ],
                    formula: "0.38 √ó 0.95 + 0.30 √ó 0.88 + 0.32 √ó 0.91 = 0.916",
                    final_conclusion: "Licenziamento NULLO (Art. 54 TU Maternit√† D.Lgs. 151/2001)",
                    final_confidence: 0.916,
                    key_points: [
                        "Divieto licenziamento dall'inizio gravidanza a 1 anno et√† bambino",
                        "Sanzione: NULLIT√Ä (non annullabilit√†)",
                        "Diritto reintegrazione + risarcimento danno",
                        "Eccezione: giusta causa per gravi inadempienze"
                    ],
                    caveats: [
                        { text: "Giusta causa Art. 2119 c.c. pu√≤ giustificare licenziamento anche durante gravidanza", severity: "MEDIUM" }
                    ],
                    sources: [
                        { type: "norm", id: "dlgs-151-2001-art-54", title: "Divieto di licenziamento", citations: 847, relevance: 0.98, link: "https://www.normattiva.it/uri-res/N2Ls?urn:nir:stato:decreto.legislativo:2001-03-26;151~art54" },
                        { type: "norm", id: "cost-art-37", title: "Tutela lavoro femminile", citations: 1523, relevance: 0.94 },
                        { type: "precedent", id: "Cass. 24015/2019", court: "Cassazione", citations: 156, relevance: 0.97 }
                    ]
                },
                traceability: {
                    execution_time_ms: 5124,
                    total_tokens: 9876,
                    model_versions: {
                        query_understanding: "distilbert-it-legal v2.3",
                        router: "RLCF v5.1",
                        reasoning: "GPT-4 Turbo"
                    },
                    compliance: [
                        { feature: "Entity Privacy", standard: "GDPR", status: "compliant", details: "Nessun dato personale identifiable" },
                        { feature: "Audit Trail", standard: "ISO 27001", status: "compliant", details: "Full trace disponibile" }
                    ],
                    feedback_history: []
                },
                export: { available_formats: ["JSON", "Markdown", "PDF", "CSV"] }
            },
            "3": {
                id: 3,
                numero: 3,
                titolo: "Diritto Oblio Digitale",
                emoji: "üîç",
                query: "Posso chiedere la cancellazione dei miei dati da Google?",
                query_understanding: {
                    abbreviation_expansion: [],
                    entity_extraction: [
                        { token: "dati", type: "LEGALOBJECT", value: "dati_personali", pos_tag: "NOUN", confidence: 0.94 },
                        { token: "Google", type: "ORGANIZATION", value: "Google LLC", pos_tag: "PROPN", confidence: 0.98 },
                        { token: "cancellazione", type: "ACTION", value: "diritto_cancellazione", pos_tag: "NOUN", confidence: 0.93 }
                    ],
                    concept_mapping: {
                        candidates: ["privacy", "dati", "cancellazione", "GDPR"],
                        approved: ["diritto_oblio", "diritto_cancellazione", "trattamento_dati", "bilanciamento_interessi"],
                        excluded: []
                    },
                    intent_classification: [
                        { intent: "diritto_privacy", probability: 0.95, ranking: 1, selected: true }
                    ],
                    temporal_extraction: { temporal_scope: "current", range: null, default_used: true },
                    complexity_scoring: {
                        entity_count: 0.28,
                        intent_complexity: 0.22,
                        temporal_constraints: 0,
                        specificity: 0.22,
                        final: 0.72,
                        formula: "0.28 + 0.22 + 0 + 0.22 = 0.72"
                    }
                },
                kg_enrichment: {
                    cypher_queries: [
                        { query: "MATCH (c:Concept)-[:REGULATED_BY]->(n:Norm) WHERE c.name IN ['diritto_oblio', 'diritto_cancellazione'] RETURN n", results: 7, time_ms: 44 }
                    ],
                    mapped_norms: [
                        { 
                            id: "GDPR-art-17", 
                            title: "Diritto alla cancellazione ('diritto all'oblio')", 
                            version: "current", 
                            fulltext: "L'interessato ha il diritto di ottenere dal titolare del trattamento la cancellazione dei dati personali che lo riguardano senza ingiustificato ritardo e il titolare del trattamento ha l'obbligo di cancellare senza ingiustificato ritardo i dati personali, se sussiste uno dei motivi seguenti: a) i dati personali non sono pi√π necessari rispetto alle finalit√† per le quali sono stati raccolti o altrimenti trattati; b) l'interessato revoca il consenso su cui si basa il trattamento; c) l'interessato si oppone al trattamento; d) i dati personali sono stati trattati illecitamente; e) i dati personali devono essere cancellati per adempiere un obbligo legale.",
                            link: "https://gdpr-text.com/it/read/article-17/",
                            related_concepts: ["diritto_oblio", "diritto_cancellazione"]
                        }
                    ],
                    jurisprudence: [
                        { 
                            id: "Corte UE C-131/12", 
                            court: "Corte di Giustizia UE", 
                            date: "2014",
                            authority_score: 0.98, 
                            citations: 1247, 
                            abstract: "Sentenza storica 'Google Spain' riconosce diritto all'oblio. Bilanciamento necessario tra privacy (GDPR Art. 17) e libert√† informazione (Carta UE Art. 11). Motori ricerca devono valutare caso per caso."
                        }
                    ],
                    related_concepts_depth2: {
                        depth1: ["libert√†_informazione", "bilanciamento_interessi"],
                        depth2: ["interesse_pubblico", "rilevanza_temporale"]
                    }
                },
                router: {
                    expert_selection: [
                        { expert: "Literal Interpreter", confidence: 0.90, reason: "Interpretazione Art. 17 GDPR" },
                        { expert: "Teleological Expert", confidence: 0.87, reason: "Bilanciamento privacy vs libert√† informazione" },
                        { expert: "Precedent Expert", confidence: 0.92, reason: "Sentenza Google Spain fondamentale" }
                    ],
                    retrieval_agents: ["KG Agent", "API Agent", "VectorDB Agent"],
                    expected_iterations: 1,
                    router_confidence: 0.90
                },
                retrieval: {
                    kg_agent: { query_time_ms: 44, results: 11, cache_status: "hit", norms_retrieved: ["GDPR-art-17"] },
                    api_agent: { requests: 2, responses: 2, status: 200, time_ms: 134, fallback: false },
                    vectordb_agent: { topk: 5, query_time_ms: 81, results: 5, similarity_scores: [0.95, 0.92, 0.88, 0.85, 0.79] },
                    aggregated_timeline: [
                        { time_ms: 44, agent: "KG Agent", status: "completed" },
                        { time_ms: 81, agent: "VectorDB Agent", status: "completed" },
                        { time_ms: 134, agent: "API Agent", status: "completed" }
                    ]
                },
                reasoning: {
                    experts: [
                        {
                            name: "Literal Interpreter",
                            method: "letterale",
                            steps: [
                                { step: 1, description: "GDPR Art. 17: diritto cancellazione dati personali", evidence: "Norma: GDPR-art-17", confidence_update: 0.88 },
                                { step: 2, description: "Condizioni Art. 17: dati non pi√π necessari, revoca consenso, trattamento illecito", evidence: "GDPR-art-17 lett. a-e", confidence_update: 0.90 }
                            ],
                            verdict: "RICONOSCIUTO con condizioni",
                            confidence: 0.90,
                            sources: ["GDPR-art-17"]
                        },
                        {
                            name: "Teleological Expert",
                            method: "teleologico",
                            steps: [
                                { step: 1, description: "Ratio: protezione dati personali vs libert√† espressione", evidence: "GDPR considerando 65", confidence_update: 0.84 },
                                { step: 2, description: "Bilanciamento caso per caso: rilevanza pubblica vs privacy", evidence: "Principio proporzionalit√†", confidence_update: 0.87 }
                            ],
                            verdict: "BILANCIATO caso per caso",
                            confidence: 0.87,
                            sources: ["GDPR-art-17"]
                        },
                        {
                            name: "Precedent Expert",
                            method: "jurisprudenza",
                            steps: [
                                { step: 1, description: "Corte UE C-131/12 'Google Spain': diritto oblio riconosciuto", evidence: "Precedente: Corte UE C-131/12", confidence_update: 0.90 },
                                { step: 2, description: "Test: interesse pubblico > privacy? Se NO ‚Üí cancellazione", evidence: "Corte UE C-131/12 criterio", confidence_update: 0.92 }
                            ],
                            verdict: "RICONOSCIUTO ma BILANCIATO",
                            confidence: 0.92,
                            sources: ["Corte UE C-131/12"]
                        }
                    ],
                    consensus: { divergence: 0.05, confidence_avg: 0.897, convergence_status: "CONVERGED", consensus_verdict: "RICONOSCIUTO BILANCIATO" }
                },
                loop_controller: {
                    metrics: [
                        { metric: "confidence_avg", threshold: 0.85, actual: 0.897, status: "PASS" },
                        { metric: "divergence_max", threshold: 0.15, actual: 0.05, status: "PASS" }
                    ],
                    decision: "STOP",
                    rationale: "Convergenza raggiunta, criterio soddisfatto",
                    iterations: 1
                },
                synthesis: {
                    mode: "convergent",
                    weights: [
                        { expert: "Literal Interpreter", weight: 0.33, confidence: 0.90, contribution: 0.297 },
                        { expert: "Teleological Expert", weight: 0.31, confidence: 0.87, contribution: 0.270 },
                        { expert: "Precedent Expert", weight: 0.36, confidence: 0.92, contribution: 0.331 }
                    ],
                    formula: "0.33 √ó 0.90 + 0.31 √ó 0.87 + 0.36 √ó 0.92 = 0.898",
                    final_conclusion: "Diritto RICONOSCIUTO ma BILANCIATO con libert√† espressione",
                    final_confidence: 0.898,
                    key_points: [
                        "GDPR Art. 17: diritto cancellazione dati personali",
                        "Bilanciamento con libert√† espressione (Carta UE Art. 11)",
                        "Test caso-per-caso: rilevanza pubblica vs privacy",
                        "Autorit√† Garante Privacy pu√≤ intervenire"
                    ],
                    caveats: [
                        { text: "Interesse pubblico prevalente pu√≤ negare cancellazione", severity: "MEDIUM" },
                        { text: "Libert√† stampa e informazione possono limitare diritto oblio", severity: "MEDIUM" }
                    ],
                    sources: [
                        { type: "norm", id: "GDPR-art-17", title: "Diritto alla cancellazione", citations: 3241, relevance: 0.98, link: "https://gdpr-text.com/it/read/article-17/" },
                        { type: "precedent", id: "Corte UE C-131/12", court: "Corte UE", citations: 1247, relevance: 0.97 }
                    ]
                },
                traceability: {
                    execution_time_ms: 4932,
                    total_tokens: 8754,
                    model_versions: {
                        query_understanding: "distilbert-it-legal v2.3",
                        router: "RLCF v5.1",
                        reasoning: "GPT-4 Turbo"
                    },
                    compliance: [
                        { feature: "Entity Privacy", standard: "GDPR", status: "compliant", details: "Nessun dato personale identifiable" },
                        { feature: "Audit Trail", standard: "ISO 27001", status: "compliant", details: "Full trace disponibile" }
                    ],
                    feedback_history: []
                },
                export: { available_formats: ["JSON", "Markdown", "PDF", "CSV"] }
            },
            "5": {
                id: 5,
                numero: 5,
                titolo: "Clausola Non Concorrenza",
                emoji: "üîÑ",
                query: "La clausola non concorrenza √® valida senza corrispettivo economico?",
                query_understanding: {
                    abbreviation_expansion: [],
                    entity_extraction: [
                        { token: "clausola non concorrenza", type: "LEGALOBJECT", value: "patto_non_concorrenza", pos_tag: "NOUN", confidence: 0.96 },
                        { token: "corrispettivo", type: "LEGALOBJECT", value: "onerosit√†", pos_tag: "NOUN", confidence: 0.93 }
                    ],
                    concept_mapping: {
                        candidates: ["patto", "concorrenza", "onerosit√†", "validit√†"],
                        approved: ["patto_non_concorrenza", "onerosit√†", "libert√†_lavoro", "validit√†_contrattuale"],
                        excluded: []
                    },
                    intent_classification: [
                        { intent: "validit√†_clausola", probability: 0.94, ranking: 1, selected: true }
                    ],
                    temporal_extraction: { temporal_scope: "current", range: null, default_used: true },
                    complexity_scoring: {
                        entity_count: 0.32,
                        intent_complexity: 0.28,
                        temporal_constraints: 0,
                        specificity: 0.22,
                        final: 0.82,
                        formula: "0.32 + 0.28 + 0 + 0.22 = 0.82"
                    }
                },
                kg_enrichment: {
                    cypher_queries: [
                        { query: "MATCH (c:Concept)-[:REGULATED_BY]->(n:Norm) WHERE c.name IN ['patto_non_concorrenza', 'onerosit√†'] RETURN n", results: 6, time_ms: 51 }
                    ],
                    mapped_norms: [
                        { 
                            id: "cc-art-2125", 
                            title: "Patto di non concorrenza", 
                            version: "current", 
                            fulltext: "Il patto con il quale si limita lo svolgimento dell'attivit√† del prestatore di lavoro, per il tempo successivo alla cessazione del contratto, √® nullo se non risulta da atto scritto, se non √® pattuito un corrispettivo a favore del prestatore di lavoro e se il vincolo non √® contenuto entro determinati limiti di oggetto, di tempo e di luogo.",
                            related_concepts: ["patto_non_concorrenza", "onerosit√†"]
                        },
                        { 
                            id: "cost-art-35", 
                            title: "Tutela del lavoro", 
                            version: "current", 
                            fulltext: "La Repubblica tutela il lavoro in tutte le sue forme ed applicazioni.",
                            related_concepts: ["libert√†_lavoro"]
                        }
                    ],
                    jurisprudence: [
                        { id: "Cass. 18174/2018", court: "Cassazione", date: "2018", authority_score: 0.93, citations: 184, abstract: "Patto non concorrenza nullo senza corrispettivo. Onerosit√† requisito essenziale per bilanciare limitazione libert√† lavoro." },
                        { id: "Cass. 23543/2020", court: "Cassazione", date: "2020", authority_score: 0.91, citations: 127, abstract: "Confermato orientamento: corrispettivo adeguato obbligatorio, proporzionale a vincolo temporale e geografico." },
                        { id: "Cass. 8765/2022", court: "Cassazione", date: "2022", authority_score: 0.94, citations: 96, abstract: "Onerosit√† implicita in Art. 2125 c.c. secondo interpretazione costituzionalmente orientata (Art. 35 Cost.)." }
                    ],
                    related_concepts_depth2: {
                        depth1: ["limitazione_temporale", "limitazione_geografica"],
                        depth2: ["proporzionalit√†", "bilanciamento_interessi"]
                    }
                },
                router: {
                    expert_selection: [
                        { expert: "Literal Interpreter", confidence: 0.85, reason: "Interpretazione Art. 2125 c.c." },
                        { expert: "Systemic Expert", confidence: 0.88, reason: "Coordinamento con Art. 35 Cost." },
                        { expert: "Precedent Expert", confidence: 0.92, reason: "Giurisprudenza consolidata 2018-2022" }
                    ],
                    retrieval_agents: ["KG Agent", "API Agent", "VectorDB Agent"],
                    expected_iterations: 2,
                    router_confidence: 0.88
                },
                retrieval: {
                    kg_agent: { query_time_ms: 51, results: 8, cache_status: "miss", norms_retrieved: ["cc-art-2125", "cost-art-35"] },
                    api_agent: { requests: 3, responses: 3, status: 200, time_ms: 198, fallback: false },
                    vectordb_agent: { topk: 5, query_time_ms: 102, results: 5, similarity_scores: [0.93, 0.89, 0.86, 0.82, 0.78] },
                    aggregated_timeline: [
                        { time_ms: 51, agent: "KG Agent", status: "completed" },
                        { time_ms: 102, agent: "VectorDB Agent", status: "completed" },
                        { time_ms: 198, agent: "API Agent", status: "completed" }
                    ]
                },
                reasoning: {
                    experts: [
                        {
                            name: "Literal Interpreter",
                            method: "letterale",
                            steps: [
                                { step: 1, description: "Art. 2125 c.c.: 'se non √® pattuito un corrispettivo' ‚Üí NULLO", evidence: "Norma: cc-art-2125", confidence_update: 0.82 },
                                { step: 2, description: "Interpretazione letterale: onerosit√† requisito essenziale", evidence: "Testo normativo esplicito", confidence_update: 0.85 }
                            ],
                            verdict: "NULLO senza corrispettivo",
                            confidence: 0.85,
                            sources: ["cc-art-2125"]
                        },
                        {
                            name: "Systemic Expert",
                            method: "sistematico",
                            steps: [
                                { step: 1, description: "Art. 35 Cost.: tutela lavoro ‚Üí limitazioni devono essere compensate", evidence: "Norma: cost-art-35", confidence_update: 0.86 },
                                { step: 2, description: "Bilanciamento libert√† lavoro vs autonomia contrattuale", evidence: "Interpretazione costituzionalmente orientata", confidence_update: 0.88 }
                            ],
                            verdict: "NULLO - onerosit√† implicita costituzionale",
                            confidence: 0.88,
                            sources: ["cc-art-2125", "cost-art-35"]
                        },
                        {
                            name: "Precedent Expert",
                            method: "jurisprudenza",
                            steps: [
                                { step: 1, description: "Cass. 18174/2018, 23543/2020, 8765/2022: orientamento consolidato", evidence: "Precedenti: Cass. 18174/2018, 23543/2020, 8765/2022", confidence_update: 0.90 },
                                { step: 2, description: "Onerosit√† requisito implicito per validit√† patto", evidence: "Giurisprudenza costante", confidence_update: 0.92 }
                            ],
                            verdict: "NULLO senza corrispettivo",
                            confidence: 0.92,
                            sources: ["Cass. 18174/2018", "Cass. 23543/2020", "Cass. 8765/2022"]
                        }
                    ],
                    consensus: { divergence: 0.07, confidence_avg: 0.883, convergence_status: "CONVERGED", consensus_verdict: "NULLO" }
                },
                loop_controller: {
                    iteration_1: {
                        metrics: { confidence_avg: 0.69, divergence: 0.16 },
                        decision: "CONTINUE",
                        rationale: "Divergenza alta (0.16) ‚Üí Gap: giurisprudenza consolidata su onerosit√†",
                        gap_analysis: "Onerosit√† implicita o esplicita? Orientamento consolidato?"
                    },
                    iteration_2: {
                        metrics: { confidence_avg: 0.88, divergence: 0.07 },
                        decision: "STOP",
                        rationale: "Convergenza raggiunta dopo retrieval espanso",
                        gap_fixed: "Giurisprudenza 2018-2022 richiede onerosit√†",
                        retrieval_expansion: {
                            new_cases: ["Cass. 18174/2018", "Cass. 23543/2020", "Cass. 8765/2022"],
                            reason: "Search expanded: 'patto non concorrenza onerosit√† corrispettivo'"
                        }
                    }
                },
                synthesis: {
                    mode: "convergent",
                    weights: [
                        { expert: "Literal Interpreter", weight: 0.30, confidence: 0.85, contribution: 0.255 },
                        { expert: "Systemic Expert", weight: 0.32, confidence: 0.88, contribution: 0.282 },
                        { expert: "Precedent Expert", weight: 0.38, confidence: 0.92, contribution: 0.350 }
                    ],
                    formula: "0.30 √ó 0.85 + 0.32 √ó 0.88 + 0.38 √ó 0.92 = 0.887",
                    final_conclusion: "NULLA senza corrispettivo (onerosit√† requisito implicito)",
                    final_confidence: 0.887,
                    key_points: [
                        "Art. 2125 c.c.: tace su onerosit√†",
                        "Giurisprudenza consolidata: onerosit√† REQUISITO IMPLICITO",
                        "Ratio: bilanciamento libert√† lavoro (Art. 35 Cost.)",
                        "Iterazione 1: incertezza ‚Üí Iterazione 2: certezza"
                    ],
                    caveats: [
                        { text: "Corrispettivo deve essere adeguato e proporzionale a vincolo", severity: "MEDIUM" }
                    ],
                    sources: [
                        { type: "norm", id: "cc-art-2125", title: "Patto di non concorrenza", citations: 1456, relevance: 0.98 },
                        { type: "norm", id: "cost-art-35", title: "Tutela del lavoro", citations: 2341, relevance: 0.89 },
                        { type: "precedent", id: "Cass. 18174/2018", court: "Cassazione", citations: 184, relevance: 0.94 },
                        { type: "precedent", id: "Cass. 23543/2020", court: "Cassazione", citations: 127, relevance: 0.91 },
                        { type: "precedent", id: "Cass. 8765/2022", court: "Cassazione", citations: 96, relevance: 0.93 }
                    ]
                },
                traceability: {
                    execution_time_ms: 8234,
                    total_tokens: 14587,
                    model_versions: {
                        query_understanding: "distilbert-it-legal v2.3",
                        router: "RLCF v5.1",
                        reasoning: "GPT-4 Turbo"
                    },
                    compliance: [
                        { feature: "Entity Privacy", standard: "GDPR", status: "compliant", details: "Nessun dato personale identifiable" },
                        { feature: "Audit Trail", standard: "ISO 27001", status: "compliant", details: "Full trace disponibile" },
                        { feature: "Iterative Reasoning", standard: "ISO 27001", status: "compliant", details: "2 iterazioni tracciate" }
                    ],
                    feedback_history: [
                        { date: "2024-03-15", feedback: "Iteration gap fixed correctly", impact: "+0.8% accuracy" }
                    ]
                },
                export: { available_formats: ["JSON", "Markdown", "PDF", "CSV"] }
            }
        };

        const examples = [
            {
                numero: 1,
                emoji: "üë∂",
                titolo: "Contratto Minorenne",
                query: "√à valido un contratto firmato da un sedicenne?",
                scenario: "Query semplice su capacit√† di agire",
                complexity: 0.62,
                iterazioni: 1,
                confidence: 0.938,
                tokens: 6521,
                latency: 3847,
                entities: 3,
                concepts: 3,
                conclusion: "Contratto ANNULLABILE (Art. 2, 322 c.c.)",
                experts: ["Literal Interpreter", "Precedent Expert"],
                key_points: [
                    "Maggiore et√†: 18 anni (Art. 2 c.c.)",
                    "Minore privo capacit√† agire ‚Üí atti annullabili (Art. 322)",
                    "Annullabilit√† su istanza rappresentante legale",
                    "Ratifica possibile al raggiungimento maggiore et√†"
                ]
            },
            {
                numero: 2,
                emoji: "ü§∞",
                titolo: "Licenziamento Donna Incinta",
                query: "√à legale licenziare una donna incinta?",
                scenario: "Query su discriminazione e tutela maternit√†",
                complexity: 0.75,
                iterazioni: 1,
                confidence: 0.915,
                tokens: 9876,
                latency: 5124,
                entities: 2,
                concepts: 4,
                conclusion: "Licenziamento NULLO (Art. 54 TU Maternit√† D.Lgs. 151/2001)",
                experts: ["Literal Interpreter", "Systemic Expert", "Constitutional Expert"],
                key_points: [
                    "Divieto licenziamento: dall'inizio gravidanza a 1 anno et√† bambino",
                    "Nullit√† licenziamento discriminatorio (non semplice annullabilit√†)",
                    "Eccezione: giusta causa per gravi inadempienze lavoratrice",
                    "Tutela costituzionale (Art. 37 Cost.)"
                ]
            },
            {
                numero: 3,
                emoji: "üîç",
                titolo: "Diritto Oblio Digitale",
                query: "Posso chiedere la cancellazione dei miei dati da Google?",
                scenario: "Query su GDPR e diritti digitali",
                complexity: 0.72,
                iterazioni: 1,
                confidence: 0.887,
                tokens: 8754,
                latency: 4932,
                entities: 3,
                concepts: 4,
                conclusion: "Diritto RICONOSCIUTO ma BILANCIATO con libert√† espressione",
                experts: ["Literal Interpreter", "Teleological Expert", "Precedent Expert"],
                key_points: [
                    "GDPR Art. 17: diritto cancellazione dati personali",
                    "Bilanciamento con libert√† espressione (Carta UE Art. 11)",
                    "Test caso-per-caso: rilevanza pubblica vs privacy",
                    "Autorit√† Garante Privacy pu√≤ intervenire"
                ]
            },
            {
                numero: 4,
                emoji: "ü¶†",
                titolo: "Query Storica DL COVID",
                query: "Cosa stabiliva l'Art. 5 del DL 18/2020 durante primo lockdown?",
                scenario: "Query con vincolo temporale e multivigenza",
                complexity: 0.64,
                iterazioni: 1,
                confidence: 0.908,
                tokens: 6234,
                latency: 3654,
                entities: 3,
                concepts: 3,
                conclusion: "Divieto spostamenti ASSOLUTO salvo 3 eccezioni (17/03-10/04/2020)",
                experts: ["Literal Interpreter", "Constitutional Expert"],
                key_points: [
                    "Divieto spostamenti: assoluto salvo lavoro/salute/necessit√†",
                    "Autocertificazione obbligatoria con sanzioni penali",
                    "Deroga temporanea Art. 16 Cost. per emergenza sanitaria",
                    "Norma modificata successivamente da DL 23/2020"
                ]
            },
            {
                numero: 5,
                titolo: "Clausola Non Concorrenza",
                query: "La clausola non concorrenza √® valida senza corrispettivo?",
                scenario: "Query complessa CON ITERAZIONE üîÅ",
                complexity: 0.82,
                iterazioni: 2,
                confidence: 0.883,
                tokens: 14587,
                latency: 8234,
                entities: 3,
                concepts: 4,
                conclusion: "NULLA senza corrispettivo (onerosit√† requisito implicito)",
                experts: ["Literal Interpreter", "Systemic Expert", "Precedent Expert"],
                key_points: [
                    "Art. 2125 c.c.: tace su onerosit√†",
                    "Giurisprudenza consolidata: onerosit√† REQUISITO IMPLICITO",
                    "Ratio: bilanciamento libert√† lavoro (Art. 35 Cost.)",
                    "Iterazione 1: incertezza ‚Üí Iterazione 2: certezza"
                ]
            },
            {
                numero: 6,
                emoji: "üìú",
                titolo: "Testamento Olografo",
                query: "Il testamento olografo scritto a matita √® valido?",
                scenario: "Query su requisiti formali",
                complexity: 0.58,
                iterazioni: 1,
                confidence: 0.94,
                tokens: 4821,
                latency: 2156,
                entities: 2,
                concepts: 2,
                conclusion: "NULLO - Art. 602 c.c. richiede scrittura indelebile",
                experts: ["Literal Interpreter", "Precedent Expert"],
                key_points: [
                    "Art. 602 c.c.: autografia obbligatoria",
                    "Matita √® cancellabile ‚Üí forma non rispettata",
                    "Nullit√† assoluta (non annullabilit√†)"
                ]
            },
            {
                numero: 7,
                emoji: "üèãÔ∏è",
                titolo: "Recesso Abbonamento",
                query: "Posso disdire l'abbonamento palestra dopo 1 mese?",
                scenario: "Query su diritto recesso contratti",
                complexity: 0.68,
                iterazioni: 1,
                confidence: 0.81,
                tokens: 5634,
                latency: 2987,
                entities: 2,
                concepts: 3,
                conclusion: "Dipende: contratto durata indeterminata vs determinata",
                experts: ["Literal Interpreter", "Systemic Expert"],
                key_points: [
                    "Durata indeterminata ‚Üí S√å con preavviso 30gg",
                    "Durata determinata ‚Üí NO salvo giusta causa",
                    "Codice Consumo art-70: protezione consumatore"
                ]
            },
            {
                numero: 8,
                emoji: "ü§ñ",
                titolo: "IA come Autore",
                query: "L'IA pu√≤ essere considerata autore di un'opera?",
                scenario: "Query con lacuna ordinamento",
                complexity: 0.71,
                iterazioni: 2,
                confidence: 0.74,
                tokens: 9234,
                latency: 5876,
                entities: 2,
                concepts: 3,
                conclusion: "NO - L. 633/1941 Art. 1: autore = persona fisica",
                experts: ["Literal Interpreter", "Teleological Expert", "Analogical Expert"],
                key_points: [
                    "IA priva di personalit√† giuridica",
                    "Necessaria riforma legislativa",
                    "Dibattito UE: AI Act 2024"
                ]
            },
            {
                numero: 9,
                emoji: "‚öñÔ∏è",
                titolo: "Conflitto Norme",
                query: "Art. 2043 vs 2050 c.c.: quale prevale per danni da attivit√† pericolosa?",
                scenario: "Query su conflitto e criterio specialit√†",
                complexity: 0.65,
                iterazioni: 1,
                confidence: 0.96,
                tokens: 5123,
                latency: 2654,
                entities: 3,
                concepts: 2,
                conclusion: "Prevale Art. 2050 c.c. (norma speciale vs generale)",
                experts: ["Literal Interpreter", "Systemic Expert"],
                key_points: [
                    "Art. 2050: responsabilit√† aggravata (inversione onere prova)",
                    "Art. 2043: responsabilit√† per colpa (dolo/negligenza)",
                    "Criterio specialit√†: speciale > generale"
                ]
            },
            {
                numero: 10,
                emoji: "üè†",
                titolo: "Locazione Non Registrata",
                query: "Contratto locazione non registrato: √® nullo o irregolare?",
                scenario: "Query su validit√† vs efficacia",
                complexity: 0.61,
                iterazioni: 1,
                confidence: 0.89,
                tokens: 6876,
                latency: 3234,
                entities: 2,
                concepts: 3,
                conclusion: "VALIDO ma IRREGOLARE (validit√† vs efficacia)",
                experts: ["Literal Interpreter", "Systemic Expert", "Precedent Expert"],
                key_points: [
                    "Contratto VALIDO tra le parti",
                    "Mancata registrazione ‚Üí sanzioni fiscali",
                    "Inefficacia probatoria vs terzi (non nullit√†)"
                ]
            }
        ];

        const pipelineSteps = [
            {
                numero: 1,
                nome: "Query Understanding",
                emoji: "1Ô∏è‚É£",
                descrizione: "Normalizzazione, estrazione entit√†, mapping concetti, intent detection",
                substeps: [
                    "Normalizzazione testo query",
                    "Estrazione entit√† giuridiche",
                    "Mapping concetti al Knowledge Graph",
                    "Intent detection e classificazione"
                ]
            },
            {
                numero: 2,
                nome: "KG Enrichment",
                emoji: "2Ô∏è‚É£",
                descrizione: "Arricchimento tramite Knowledge Graph, mapping norme e relazioni",
                substeps: [
                    "Query Knowledge Graph per norme correlate",
                    "Identificazione relazioni tra entit√†",
                    "Arricchimento contesto giuridico",
                    "Creazione grafo dipendenze"
                ]
            },
            {
                numero: 3,
                nome: "LLM Router",
                emoji: "3Ô∏è‚É£",
                descrizione: "Orchestration layer che sceglie esperti e agenti di retrieval",
                substeps: [
                    "Analisi complessit√† query",
                    "Selezione esperti di reasoning",
                    "Routing a retrieval agents",
                    "Orchestrazione pipeline"
                ]
            },
            {
                numero: 4,
                nome: "Retrieval Agents",
                emoji: "4Ô∏è‚É£",
                descrizione: "Esecuzione parallela KG Agent, API Agent, VectorDB Agent",
                substeps: [
                    "KG Agent: retrieval da Knowledge Graph",
                    "API Agent: query a database giuridici",
                    "VectorDB Agent: similarity search",
                    "Aggregazione risultati retrieval"
                ]
            },
            {
                numero: 5,
                nome: "Reasoning Experts",
                emoji: "5Ô∏è‚É£",
                descrizione: "Reasoning iterativo con esperti (Literal, Systemic, Constitutional, ecc.)",
                substeps: [
                    "Literal Interpreter: analisi testuale norme",
                    "Systemic Expert: coerenza sistematica",
                    "Constitutional Expert: conformit√† costituzionale",
                    "Precedent Expert: analisi giurisprudenza"
                ]
            },
            {
                numero: 6,
                nome: "Synthesis",
                emoji: "6Ô∏è‚É£",
                descrizione: "Aggregazione outputs e decisione iterazione via Loop Controller",
                substeps: [
                    "Aggregazione reasoning degli esperti",
                    "Calcolo confidence score",
                    "Loop Controller: valutazione iterazione",
                    "Generazione risposta finale"
                ]
            }
        ];

        // State
        let selectedExample = null;
        let simulationRunning = false;
        let simulationPaused = false;
        let currentStep = 0;
        let timerInterval = null;
        let startTime = 0;
        let elapsedTime = 0;
        let stepTimeouts = [];
        let simulationSpeed = 1;
        let autoplayMode = false;

        // Initialize
        // Pipeline Steps
        const pipelineStepsDetailed = [
            {
                numero: 1,
                nome: "Query Understanding",
                icon: "üîç",
                substages: [
                    { id: "1.1", name: "Abbreviation Expansion" },
                    { id: "1.2", name: "Entity Extraction" },
                    { id: "1.3", name: "Concept Mapping" },
                    { id: "1.4", name: "Intent Classification" },
                    { id: "1.5", name: "Temporal Extraction" },
                    { id: "1.6", name: "Complexity Scoring" }
                ]
            },
            { numero: 2, nome: "KG Enrichment", icon: "üóÇÔ∏è", substages: [] },
            { numero: 3, nome: "LLM Router", icon: "üéØ", substages: [] },
            { numero: 4, nome: "Retrieval Agents", icon: "üîå", substages: [] },
            { numero: 5, nome: "Reasoning Experts", icon: "üë•", substages: [] },
            { numero: 6, nome: "Loop Controller", icon: "üîÑ", substages: [] },
            { numero: 7, nome: "Synthesis", icon: "‚ö°", substages: [] },
            { numero: 8, nome: "Traceability", icon: "üìä", substages: [] }
        ];

        // State
        let currentExampleData = null;
        let currentStepIndex = 0;

        function init() {
            renderExamples();
            renderNavigationTree();
            renderBottomTimeline();
            setupEventListeners();
        }

        function renderExamples() {
            const grid = document.getElementById('examplesGrid');
            grid.innerHTML = examples.map(example => {
                const complexityClass = example.complexity < 0.6 ? 'complexity-low' : 
                                        example.complexity < 0.75 ? 'complexity-medium' : 'complexity-high';
                return `
                    <div class="example-btn" data-id="${example.numero}">
                        <span class="example-emoji">${example.emoji}</span>
                        <div class="example-number">#${example.numero}</div>
                        <div class="example-title">${example.titolo}</div>
                        <div class="example-query-preview">${example.query}</div>
                        <div class="example-stats">
                            <span class="stat-badge ${complexityClass}">C: ${example.complexity.toFixed(2)}</span>
                            <span class="stat-badge">I: ${example.iterazioni}</span>
                            <span class="stat-badge">Conf: ${(example.confidence * 100).toFixed(1)}%</span>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderFlowDiagram() {
            const container = document.getElementById('flowContainer');
            container.innerHTML = pipelineSteps.map((step, index) => `
                ${index > 0 ? '<div class="flow-arrow">‚Üí</div>' : ''}
                <div class="flow-step" data-step="${step.numero}">
                    <div class="flow-step-number">${step.emoji}</div>
                    <div class="flow-step-name">${step.nome}</div>
                </div>
            `).join('');
        }

        function showStep(stepNum) {
            // Hide all steps
            document.querySelectorAll('.step-section').forEach(s => s.classList.remove('visible'));
            
            // Show selected step
            const step = document.getElementById(`step${stepNum}`);
            if (step) {
                step.classList.add('visible');
                step.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
            
            // Update navigation
            document.querySelectorAll('.nav-item').forEach((item, idx) => {
                item.classList.toggle('active', idx + 1 === stepNum);
                if (idx + 1 < stepNum) item.classList.add('completed');
                else item.classList.remove('completed');
            });
            
            // Update timeline
            document.querySelectorAll('.timeline-step').forEach((item, idx) => {
                item.classList.toggle('active', idx + 1 === stepNum);
                if (idx + 1 < stepNum) item.classList.add('completed');
                else item.classList.remove('completed');
            });
            
            // Update progress indicator
            document.getElementById('currentStepNum').textContent = stepNum;
            
            // Update JSON panel
            updateJSONPanel(stepNum);
            
            currentStepIndex = stepNum;
        }

        function updateJSONPanel(stepNum) {
            const jsonViewer = document.getElementById('jsonViewer');
            const sectionMap = {
                1: 'query_understanding',
                2: 'kg_enrichment',
                3: 'router',
                4: 'retrieval',
                5: 'reasoning',
                6: 'loop_controller',
                7: 'synthesis',
                8: 'traceability'
            };
            
            const section = sectionMap[stepNum];
            if (section && currentExampleData[section]) {
                const json = JSON.stringify(currentExampleData[section], null, 2);
                jsonViewer.innerHTML = `<pre>${syntaxHighlight(json)}</pre>`;
            }
        }

        function syntaxHighlight(json) {
            json = json.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
            return json.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g, function (match) {
                let cls = 'json-number';
                if (/^"/.test(match)) {
                    if (/:$/.test(match)) {
                        cls = 'json-key';
                    } else {
                        cls = 'json-string';
                    }
                } else if (/true|false/.test(match)) {
                    cls = 'json-boolean';
                } else if (/null/.test(match)) {
                    cls = 'json-null';
                }
                return '<span class="' + cls + '">' + match + '</span>';
            });
        }

        function setupEventListeners() {
            // Sidebar toggle
            document.getElementById('sidebarToggle').addEventListener('click', () => {
                document.getElementById('sidebar').classList.toggle('collapsed');
            });
            
            // Panel tabs
            document.querySelectorAll('.panel-tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    document.querySelectorAll('.panel-tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.panel-content').forEach(c => c.classList.remove('active'));
                    tab.classList.add('active');
                    document.getElementById(tab.dataset.tab + 'Panel').classList.add('active');
                });
            });
            
            // Navigation tree
            document.addEventListener('click', (e) => {
                const navItem = e.target.closest('.nav-item');
                if (navItem) {
                    const stepNum = parseInt(navItem.dataset.step);
                    showStep(stepNum);
                }
                
                const timelineStep = e.target.closest('.timeline-step');
                if (timelineStep) {
                    const stepNum = parseInt(timelineStep.dataset.step);
                    showStep(stepNum);
                }
            });
            
            // Example selection
            document.getElementById('examplesGrid').addEventListener('click', (e) => {
                const btn = e.target.closest('.example-btn');
                if (btn) {
                    const id = parseInt(btn.dataset.id);
                    selectExample(id);
                    // Scroll selected card into center
                    btn.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
                }
            });

            // Control buttons
            document.getElementById('startBtn').addEventListener('click', startSimulation);
            document.getElementById('pauseBtn').addEventListener('click', pauseSimulation);
            document.getElementById('resetBtn').addEventListener('click', resetSimulation);
            document.getElementById('skipBtn').addEventListener('click', skipToEnd);
            document.getElementById('autoplayBtn').addEventListener('click', toggleAutoplay);
            
            // Speed control
            const speedSlider = document.getElementById('speedSlider');
            speedSlider.addEventListener('input', (e) => {
                simulationSpeed = parseFloat(e.target.value);
                document.getElementById('speedValue').textContent = simulationSpeed.toFixed(1) + 'x';
            });

            // Keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                if (e.code === 'Space' && selectedExample) {
                    e.preventDefault();
                    if (simulationRunning) pauseSimulation();
                    else if (simulationPaused || currentStep === 0) startSimulation();
                }
                if (e.code === 'KeyR' && selectedExample) {
                    e.preventDefault();
                    resetSimulation();
                }
                if (e.code === 'KeyS' && selectedExample) {
                    e.preventDefault();
                    skipToEnd();
                }
            });
        }

        function renderNavigationTree() {
            const navTree = document.getElementById('navTree');
            navTree.innerHTML = pipelineStepsDetailed.map(step => `
                <li class="nav-item" data-step="${step.numero}">
                    ${step.icon} ${step.nome}
                    ${step.substages.length > 0 ? `
                        <ul class="nav-substeps">
                            ${step.substages.map(sub => `<li class="nav-substep" data-substage="${sub.id}">${sub.name}</li>`).join('')}
                        </ul>
                    ` : ''}
                </li>
            `).join('');
        }

        function renderBottomTimeline() {
            const timeline = document.getElementById('bottomTimeline');
            timeline.innerHTML = pipelineStepsDetailed.map(step => `
                <div class="timeline-step" data-step="${step.numero}">
                    <div class="timeline-step-icon">${step.icon}</div>
                    <div class="timeline-step-name">${step.nome}</div>
                </div>
            `).join('');
        }

        function selectExample(id) {
            selectedExample = examples.find(ex => ex.numero === id);
            currentExampleData = examplesData[id.toString()] || examplesData["1"];
            
            // Update UI
            document.querySelectorAll('.example-btn').forEach(btn => {
                btn.classList.toggle('active', parseInt(btn.dataset.id) === id);
            });

            // Show query display
            const queryDisplay = document.getElementById('queryDisplay');
            queryDisplay.classList.add('visible');
            document.getElementById('queryText').textContent = selectedExample.query;
            
            const statsHTML = `
                <div class="query-stat">
                    <div class="query-stat-label">Complessit√†</div>
                    <div class="query-stat-value">${selectedExample.complexity.toFixed(2)}</div>
                </div>
                <div class="query-stat">
                    <div class="query-stat-label">Iterazioni</div>
                    <div class="query-stat-value">${selectedExample.iterazioni}</div>
                </div>
                <div class="query-stat">
                    <div class="query-stat-label">Confidence</div>
                    <div class="query-stat-value">${(selectedExample.confidence * 100).toFixed(1)}%</div>
                </div>
                <div class="query-stat">
                    <div class="query-stat-label">Latency</div>
                    <div class="query-stat-value">${selectedExample.latency}ms</div>
                </div>
                <div class="query-stat">
                    <div class="query-stat-label">Tokens</div>
                    <div class="query-stat-value">${selectedExample.tokens.toLocaleString()}</div>
                </div>
            `;
            document.getElementById('queryStats').innerHTML = statsHTML;

            // Show control panel
            document.getElementById('controlPanel').classList.add('visible');

            // Reset simulation state
            resetSimulation();
            
            // Generate step sections
            generateStepSections();
        }

        function generateStepSections() {
            const container = document.getElementById('stepSections');
            if (!currentExampleData) return;
            
            container.innerHTML = '';
            
            // Step 1: Query Understanding
            container.innerHTML += renderStep1();
            
            // Step 2: KG Enrichment
            container.innerHTML += renderStep2();
            
            // Step 3: Router
            container.innerHTML += renderStep3();
            
            // Step 4: Retrieval
            container.innerHTML += renderStep4();
            
            // Step 5: Reasoning
            container.innerHTML += renderStep5();
            
            // Step 6: Loop Controller
            container.innerHTML += renderStep6();
            
            // Step 7: Synthesis
            container.innerHTML += renderStep7();
            
            // Step 8: Traceability
            container.innerHTML += renderStep8();
            
            // Add expand/collapse handlers
            document.querySelectorAll('.substage-header').forEach(header => {
                header.addEventListener('click', () => {
                    header.parentElement.classList.toggle('expanded');
                });
            });
        }

        function renderStep1() {
            const data = currentExampleData.query_understanding;
            if (!data) return '';
            
            return `
                <div class="step-section" id="step1" data-step="1">
                    <div class="step-header-main">
                        <div class="step-title-main">
                            <span class="step-badge">STEP 1</span>
                            üîç Query Understanding
                        </div>
                    </div>
                    
                    <!-- 1.1 Abbreviation Expansion -->
                    <div class="substage-panel expanded">
                        <div class="substage-header">
                            <div class="substage-title">1.1 Abbreviation Expansion</div>
                            <span class="expand-icon">‚ñº</span>
                        </div>
                        <div class="substage-content">
                            <p><strong>Original Query:</strong> ${currentExampleData.query}</p>
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Original Token</th>
                                        <th>Expanded</th>
                                        <th>Confidence</th>
                                        <th>RLCF Feedback</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${data.abbreviation_expansion ? data.abbreviation_expansion.map(item => `
                                        <tr>
                                            <td>${item.token}</td>
                                            <td>${item.expanded}</td>
                                            <td>${(item.confidence * 100).toFixed(1)}%</td>
                                            <td>${item.rlcf_feedback || 'N/A'}</td>
                                        </tr>
                                    `).join('') : '<tr><td colspan="4">No data</td></tr>'}
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <!-- 1.2 Entity Extraction -->
                    <div class="substage-panel">
                        <div class="substage-header">
                            <div class="substage-title">1.2 Entity Extraction</div>
                            <span class="expand-icon">‚ñº</span>
                        </div>
                        <div class="substage-content">
                            <div style="margin: 15px 0; padding: 15px; background: rgba(0,0,0,0.3); border-radius: 8px;">
                                ${highlightEntities(currentExampleData.query, data.entity_extraction)}
                            </div>
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Token</th>
                                        <th>Entity Type</th>
                                        <th>Value</th>
                                        <th>POS Tag</th>
                                        <th>Confidence</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${data.entity_extraction ? data.entity_extraction.map(entity => `
                                        <tr>
                                            <td>${entity.token}</td>
                                            <td><span class="entity-highlight entity-${entity.type.toLowerCase()}">${entity.type}</span></td>
                                            <td>${entity.value}</td>
                                            <td>${entity.pos_tag}</td>
                                            <td>${(entity.confidence * 100).toFixed(1)}%</td>
                                        </tr>
                                    `).join('') : '<tr><td colspan="5">No data</td></tr>'}
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <!-- 1.3 Concept Mapping -->
                    <div class="substage-panel">
                        <div class="substage-header">
                            <div class="substage-title">1.3 Concept Mapping</div>
                            <span class="expand-icon">‚ñº</span>
                        </div>
                        <div class="substage-content">
                            <p><strong>Candidati LLM:</strong></p>
                            <div class="concept-viz">
                                ${data.concept_mapping && data.concept_mapping.candidates ? data.concept_mapping.candidates.map(c => 
                                    `<span class="concept-node">${c}</span>`
                                ).join('') : ''}
                            </div>
                            <p style="margin-top: 20px;"><strong>Concetti Approvati (KG Validated):</strong></p>
                            <div class="concept-viz">
                                ${data.concept_mapping && data.concept_mapping.approved ? data.concept_mapping.approved.map(c => 
                                    `<span class="concept-node" style="border-color: var(--color-green);">${c}</span>`
                                ).join('') : ''}
                            </div>
                            ${data.concept_mapping && data.concept_mapping.excluded && data.concept_mapping.excluded.length > 0 ? `
                                <p style="margin-top: 20px;"><strong>Concetti Esclusi:</strong></p>
                                <div class="concept-viz">
                                    ${data.concept_mapping.excluded.map(item => 
                                        `<span class="concept-node excluded" title="${item.reason}">${item.concept}</span>`
                                    ).join('')}
                                </div>
                            ` : ''}
                        </div>
                    </div>
                    
                    <!-- 1.4 Intent Classification -->
                    <div class="substage-panel">
                        <div class="substage-header">
                            <div class="substage-title">1.4 Intent Classification</div>
                            <span class="expand-icon">‚ñº</span>
                        </div>
                        <div class="substage-content">
                            <div class="bar-chart">
                                ${data.intent_classification ? data.intent_classification.map(intent => `
                                    <div class="bar-item">
                                        <div class="bar-label">
                                            <span>${intent.intent}</span>
                                            <span>${(intent.probability * 100).toFixed(1)}%</span>
                                        </div>
                                        <div class="bar-fill-container">
                                            <div class="bar-fill" style="width: ${intent.probability * 100}%">
                                                ${intent.selected ? '‚úì SELECTED' : ''}
                                            </div>
                                        </div>
                                    </div>
                                `).join('') : 'No data'}
                            </div>
                        </div>
                    </div>
                    
                    <!-- 1.5 Temporal Extraction -->
                    <div class="substage-panel">
                        <div class="substage-header">
                            <div class="substage-title">1.5 Temporal Extraction</div>
                            <span class="expand-icon">‚ñº</span>
                        </div>
                        <div class="substage-content">
                            ${data.temporal_extraction ? `
                                <p><strong>Temporal Scope:</strong> ${data.temporal_extraction.temporal_scope}</p>
                                <p><strong>Range:</strong> ${data.temporal_extraction.range || 'N/A'}</p>
                                <p><strong>Default Used:</strong> ${data.temporal_extraction.default_used ? 'Yes (current version)' : 'No'}</p>
                            ` : 'No temporal constraints'}
                        </div>
                    </div>
                    
                    <!-- 1.6 Complexity Scoring -->
                    <div class="substage-panel">
                        <div class="substage-header">
                            <div class="substage-title">1.6 Complexity Scoring</div>
                            <span class="expand-icon">‚ñº</span>
                        </div>
                        <div class="substage-content">
                            <div class="gauge-container">
                                <div class="gauge" style="background: conic-gradient(var(--color-green) 0deg, var(--color-yellow) ${data.complexity_scoring.final * 180}deg, var(--color-pink) ${data.complexity_scoring.final * 360}deg, transparent ${data.complexity_scoring.final * 360}deg)">
                                    <div class="gauge-value">${data.complexity_scoring.final.toFixed(2)}</div>
                                </div>
                            </div>
                            <table class="data-table">
                                <thead>
                                    <tr><th>Factor</th><th>Value</th></tr>
                                </thead>
                                <tbody>
                                    <tr><td>Entity Count</td><td>+${data.complexity_scoring.entity_count}</td></tr>
                                    <tr><td>Intent Complexity</td><td>+${data.complexity_scoring.intent_complexity}</td></tr>
                                    <tr><td>Temporal Constraints</td><td>+${data.complexity_scoring.temporal_constraints}</td></tr>
                                    <tr><td>Specificity</td><td>${data.complexity_scoring.specificity}</td></tr>
                                    <tr style="font-weight: 700; background: rgba(0,212,255,0.1);">
                                        <td>Final Score</td>
                                        <td>${data.complexity_scoring.final}</td>
                                    </tr>
                                </tbody>
                            </table>
                            <p style="margin-top: 15px; font-family: 'Courier New', monospace; color: var(--color-cyan);">
                                <strong>Formula:</strong> ${data.complexity_scoring.formula}
                            </p>
                        </div>
                    </div>
                    
                    <button class="copy-btn" onclick="copyJSON('query_understanding')">üìã Copy JSON Output</button>
                </div>
            `;
        }

        function highlightEntities(text, entities) {
            if (!entities || entities.length === 0) return text;
            
            let highlighted = text;
            entities.forEach(entity => {
                const regex = new RegExp(`\\b${entity.token}\\b`, 'gi');
                highlighted = highlighted.replace(regex, 
                    `<span class="entity-highlight entity-${entity.type.toLowerCase()}" title="${entity.type}: ${entity.value} (${(entity.confidence*100).toFixed(0)}%)">${entity.token}</span>`
                );
            });
            return highlighted;
        }

        function renderStep2() {
            const data = currentExampleData.kg_enrichment;
            if (!data) return '';
            
            return `
                <div class="step-section" id="step2" data-step="2">
                    <div class="step-header-main">
                        <div class="step-title-main">
                            <span class="step-badge">STEP 2</span>
                            üóÇÔ∏è Knowledge Graph Enrichment
                        </div>
                    </div>
                    
                    <div class="substage-panel expanded">
                        <div class="substage-header">
                            <div class="substage-title">2.1 Cypher Query Execution</div>
                            <span class="expand-icon">‚ñº</span>
                        </div>
                        <div class="substage-content">
                            ${data.cypher_queries ? data.cypher_queries.map(q => `
                                <div class="json-viewer">
                                    <pre style="color: var(--color-green);">${q.query}</pre>
                                    <p style="margin-top: 10px;">‚è±Ô∏è Query time: <strong>${q.time_ms}ms</strong> | Results: <strong>${q.results}</strong></p>
                                </div>
                            `).join('') : 'No queries'}
                        </div>
                    </div>
                    
                    <div class="substage-panel">
                        <div class="substage-header">
                            <div class="substage-title">2.2 Mapped Norms (Full Text)</div>
                            <span class="expand-icon">‚ñº</span>
                        </div>
                        <div class="substage-content">
                            ${data.mapped_norms ? data.mapped_norms.map(norm => `
                                <div style="background: rgba(0,212,255,0.05); padding: 20px; margin: 15px 0; border-radius: 10px; border-left: 4px solid var(--color-cyan);">
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                                        <div>
                                            <strong style="color: var(--color-cyan); font-size: 1.1rem;">${norm.id}</strong>
                                            <div style="color: var(--color-text); font-size: 0.95rem; margin-top: 5px;">${norm.title}</div>
                                        </div>
                                        ${norm.link ? `<a href="${norm.link}" target="_blank" class="copy-btn" style="padding: 8px 15px; font-size: 0.85rem; text-decoration: none;">üîó Normattiva</a>` : ''}
                                    </div>
                                    ${norm.fulltext ? `
                                        <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 8px; margin-top: 10px; line-height: 1.7; font-size: 0.9rem; color: var(--color-text);">
                                            ${norm.fulltext}
                                        </div>
                                    ` : ''}
                                    ${norm.related_concepts && norm.related_concepts.length > 0 ? `
                                        <div style="margin-top: 12px;">
                                            <strong style="color: var(--color-text-dim); font-size: 0.85rem;">Related Concepts:</strong>
                                            <div class="concept-viz" style="margin-top: 8px;">
                                                ${norm.related_concepts.map(c => `<span class="concept-node" style="font-size: 0.8rem;">${c}</span>`).join('')}
                                            </div>
                                        </div>
                                    ` : ''}
                                </div>
                            `).join('') : 'No data'}
                        </div>
                    </div>
                    
                    <div class="substage-panel">
                        <div class="substage-header">
                            <div class="substage-title">2.3 Jurisprudence Discovery (with Abstracts)</div>
                            <span class="expand-icon">‚ñº</span>
                        </div>
                        <div class="substage-content">
                            ${data.jurisprudence ? data.jurisprudence.map(jp => `
                                <div style="background: rgba(255,0,255,0.05); padding: 20px; margin: 15px 0; border-radius: 10px; border-left: 4px solid var(--color-magenta);">
                                    <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 12px;">
                                        <div>
                                            <strong style="color: var(--color-magenta); font-size: 1.1rem;">‚öñÔ∏è ${jp.id}</strong>
                                            <div style="color: var(--color-text-dim); font-size: 0.85rem; margin-top: 5px;">${jp.court} ${jp.date ? `(${jp.date})` : ''}</div>
                                        </div>
                                        <div style="text-align: right;">
                                            <div style="background: rgba(0,255,136,0.2); padding: 5px 12px; border-radius: 15px; font-size: 0.85rem; color: var(--color-green); font-weight: 700; margin-bottom: 5px;">
                                                Authority: ${(jp.authority_score * 100).toFixed(1)}%
                                            </div>
                                            <div style="color: var(--color-text-dim); font-size: 0.8rem;">
                                                Citations: ${jp.citations}
                                            </div>
                                        </div>
                                    </div>
                                    ${jp.abstract ? `
                                        <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 8px; line-height: 1.6; font-size: 0.9rem; font-style: italic; color: var(--color-text);">
                                            "${jp.abstract}"
                                        </div>
                                    ` : ''}
                                </div>
                            `).join('') : 'No jurisprudence data'}
                        </div>
                    </div>
                    
                    <button class="copy-btn" onclick="copyJSON('kg_enrichment')">üìã Copy JSON Output</button>
                </div>
            `;
        }

        function renderStep3() {
            const data = currentExampleData.router;
            if (!data) return '';
            
            return `
                <div class="step-section" id="step3" data-step="3">
                    <div class="step-header-main">
                        <div class="step-title-main">
                            <span class="step-badge">STEP 3</span>
                            üéØ LLM Router
                        </div>
                    </div>
                    
                    <div class="substage-panel expanded">
                        <div class="substage-header">
                            <div class="substage-title">3.1 Expert Selection</div>
                            <span class="expand-icon">‚ñº</span>
                        </div>
                        <div class="substage-content">
                            <table class="data-table">
                                <thead>
                                    <tr><th>Expert</th><th>Confidence</th><th>Reason</th></tr>
                                </thead>
                                <tbody>
                                    ${data.expert_selection ? data.expert_selection.map(exp => `
                                        <tr>
                                            <td><strong>${exp.expert}</strong></td>
                                            <td>${(exp.confidence * 100).toFixed(1)}%</td>
                                            <td>${exp.reason || ''}</td>
                                        </tr>
                                    `).join('') : '<tr><td colspan="3">No data</td></tr>'}
                                </tbody>
                            </table>
                            <p style="margin-top: 15px;"><strong>Router Confidence:</strong> ${(data.router_confidence * 100).toFixed(1)}%</p>
                        </div>
                    </div>
                    
                    <div class="substage-panel">
                        <div class="substage-header">
                            <div class="substage-title">3.2 Retrieval Agents Planning</div>
                            <span class="expand-icon">‚ñº</span>
                        </div>
                        <div class="substage-content">
                            <p><strong>Selected Agents:</strong></p>
                            <div class="concept-viz">
                                ${data.retrieval_agents ? data.retrieval_agents.map(agent => 
                                    `<span class="concept-node" style="background: rgba(0,255,136,0.2); border-color: var(--color-green);">${agent}</span>`
                                ).join('') : ''}
                            </div>
                        </div>
                    </div>
                    
                    <div class="substage-panel">
                        <div class="substage-header">
                            <div class="substage-title">3.3 Iteration Strategy</div>
                            <span class="expand-icon">‚ñº</span>
                        </div>
                        <div class="substage-content">
                            <p><strong>Expected Iterations:</strong> ${data.expected_iterations}</p>
                            <p><strong>Convergence Criteria:</strong></p>
                            <ul style="list-style: none; padding-left: 0;">
                                <li>‚úì Confidence threshold: 0.85</li>
                                <li>‚úì Divergence max: 0.15</li>
                                <li>‚úì Max iterations: 3</li>
                            </ul>
                        </div>
                    </div>
                    
                    <button class="copy-btn" onclick="copyJSON('router')">üìã Copy JSON Output</button>
                </div>
            `;
        }

        function renderStep4() {
            const data = currentExampleData.retrieval;
            if (!data) return '';
            
            return `
                <div class="step-section" id="step4" data-step="4">
                    <div class="step-header-main">
                        <div class="step-title-main">
                            <span class="step-badge">STEP 4</span>
                            üîå Retrieval Agents (Parallel Execution)
                        </div>
                    </div>
                    
                    <div class="substage-panel expanded">
                        <div class="substage-header">
                            <div class="substage-title">4.1 KG Agent</div>
                            <span class="expand-icon">‚ñº</span>
                        </div>
                        <div class="substage-content">
                            ${data.kg_agent ? `
                                <p>‚è±Ô∏è Query time: <strong>${data.kg_agent.query_time_ms}ms</strong></p>
                                <p>üìä Results: <strong>${data.kg_agent.results}</strong></p>
                                <p>üíæ Cache: <strong>${data.kg_agent.cache_status}</strong></p>
                                <p><strong>Norms Retrieved:</strong></p>
                                <div class="concept-viz">
                                    ${data.kg_agent.norms_retrieved ? data.kg_agent.norms_retrieved.map(n => 
                                        `<span class="concept-node">${n}</span>`
                                    ).join('') : ''}
                                </div>
                            ` : 'No data'}
                        </div>
                    </div>
                    
                    <div class="substage-panel">
                        <div class="substage-header">
                            <div class="substage-title">4.2 API Agent</div>
                            <span class="expand-icon">‚ñº</span>
                        </div>
                        <div class="substage-content">
                            ${data.api_agent ? `
                                <p>üì° Requests: <strong>${data.api_agent.requests}</strong></p>
                                <p>‚úì Responses: <strong>${data.api_agent.responses}</strong></p>
                                <p>‚è±Ô∏è Time: <strong>${data.api_agent.time_ms}ms</strong></p>
                                <p>üîÑ Fallback: <strong>${data.api_agent.fallback ? 'Yes' : 'No'}</strong></p>
                                <p style="padding: 10px; background: rgba(0,255,136,0.1); border-radius: 5px; border-left: 4px solid var(--color-green);">
                                    Status: <strong>${data.api_agent.status}</strong>
                                </p>
                            ` : 'No data'}
                        </div>
                    </div>
                    
                    <div class="substage-panel">
                        <div class="substage-header">
                            <div class="substage-title">4.3 VectorDB Agent</div>
                            <span class="expand-icon">‚ñº</span>
                        </div>
                        <div class="substage-content">
                            ${data.vectordb_agent ? `
                                <p>üîù Top-K: <strong>${data.vectordb_agent.topk}</strong></p>
                                <p>‚è±Ô∏è Query time: <strong>${data.vectordb_agent.query_time_ms}ms</strong></p>
                                <p><strong>Similarity Scores:</strong></p>
                                <div class="bar-chart">
                                    ${data.vectordb_agent.similarity_scores ? data.vectordb_agent.similarity_scores.map((score, i) => `
                                        <div class="bar-item">
                                            <div class="bar-label">
                                                <span>Result ${i+1}</span>
                                                <span>${(score * 100).toFixed(1)}%</span>
                                            </div>
                                            <div class="bar-fill-container">
                                                <div class="bar-fill" style="width: ${score * 100}%"></div>
                                            </div>
                                        </div>
                                    `).join('') : ''}
                                </div>
                            ` : 'No data'}
                        </div>
                    </div>
                    
                    <button class="copy-btn" onclick="copyJSON('retrieval')">üìã Copy JSON Output</button>
                </div>
            `;
        }

        function renderStep5() {
            const data = currentExampleData.reasoning;
            if (!data) return '';
            
            return `
                <div class="step-section" id="step5" data-step="5">
                    <div class="step-header-main">
                        <div class="step-title-main">
                            <span class="step-badge">STEP 5</span>
                            üë• Reasoning Experts
                        </div>
                    </div>
                    
                    ${data.experts ? data.experts.map((expert, idx) => `
                        <div class="substage-panel expanded">
                            <div class="substage-header">
                                <div class="substage-title">5.${idx+1} ${expert.name}</div>
                                <span style="color: var(--color-green); font-weight: 700;">${(expert.confidence * 100).toFixed(1)}%</span>
                            </div>
                            <div class="substage-content">
                                <p><strong>Method:</strong> ${expert.method}</p>
                                <p><strong>Verdict:</strong> <span style="color: var(--color-magenta); font-weight: 700; font-size: 1.2rem;">${expert.verdict}</span></p>
                                <p style="margin-top: 15px;"><strong>Reasoning Steps:</strong></p>
                                <ol style="padding-left: 20px;">
                                    ${expert.steps ? expert.steps.map(step => `
                                        <li style="margin: 10px 0; padding: 10px; background: rgba(0,212,255,0.05); border-radius: 5px;">
                                            <strong>${step.description}</strong><br/>
                                            <small style="color: var(--color-text-dim);">Evidence: ${step.evidence} | Confidence: ${(step.confidence_update * 100).toFixed(1)}%</small>
                                        </li>
                                    `).join('') : ''}
                                </ol>
                                <p><strong>Sources:</strong></p>
                                <div class="concept-viz">
                                    ${expert.sources ? expert.sources.map(s => `<span class="concept-node">${s}</span>`).join('') : ''}
                                </div>
                            </div>
                        </div>
                    `).join('') : ''}
                    
                    ${data.consensus ? `
                        <div class="substage-panel expanded">
                            <div class="substage-header">
                                <div class="substage-title">Consensus Analysis</div>
                                <span class="expand-icon">‚ñº</span>
                            </div>
                            <div class="substage-content">
                                <table class="data-table">
                                    <tr><td>Divergence</td><td><strong>${data.consensus.divergence.toFixed(3)}</strong></td></tr>
                                    <tr><td>Confidence Average</td><td><strong>${(data.consensus.confidence_avg * 100).toFixed(1)}%</strong></td></tr>
                                    <tr><td>Status</td><td><strong style="color: var(--color-green);">${data.consensus.convergence_status}</strong></td></tr>
                                    <tr><td>Consensus Verdict</td><td><strong style="color: var(--color-magenta); font-size: 1.1rem;">${data.consensus.consensus_verdict}</strong></td></tr>
                                </table>
                            </div>
                        </div>
                    ` : ''}
                    
                    <button class="copy-btn" onclick="copyJSON('reasoning')">üìã Copy JSON Output</button>
                </div>
            `;
        }

        function renderStep6() {
            const data = currentExampleData.loop_controller;
            if (!data) return '';
            
            return `
                <div class="step-section" id="step6" data-step="6">
                    <div class="step-header-main">
                        <div class="step-title-main">
                            <span class="step-badge">STEP 6</span>
                            üîÑ Loop Controller
                        </div>
                    </div>
                    
                    ${data.iteration_1 ? `
                        <div class="substage-panel expanded">
                            <div class="substage-header">
                                <div class="substage-title" style="color: var(--color-orange);">üîÅ Iteration 1</div>
                                <span class="expand-icon">‚ñº</span>
                            </div>
                            <div class="substage-content">
                                <p><strong>Decision:</strong> <span style="color: var(--color-orange); font-weight: 700;">${data.iteration_1.decision}</span></p>
                                <p><strong>Metrics:</strong></p>
                                <ul style="list-style: none; padding: 0;">
                                    <li>‚Ä¢ Confidence avg: ${(data.iteration_1.metrics.confidence_avg * 100).toFixed(1)}%</li>
                                    <li>‚Ä¢ Divergence: ${data.iteration_1.metrics.divergence.toFixed(3)}</li>
                                </ul>
                                <p style="padding: 15px; background: rgba(255,107,53,0.1); border-left: 4px solid var(--color-orange); border-radius: 5px; margin-top: 15px;">
                                    <strong>Rationale:</strong> ${data.iteration_1.rationale}
                                </p>
                                <p><strong>Gap Analysis:</strong> ${data.iteration_1.gap_analysis}</p>
                            </div>
                        </div>
                    ` : ''}
                    
                    ${data.iteration_2 ? `
                        <div class="substage-panel expanded">
                            <div class="substage-header">
                                <div class="substage-title" style="color: var(--color-green);">‚úÖ Iteration 2</div>
                                <span class="expand-icon">‚ñº</span>
                            </div>
                            <div class="substage-content">
                                <p><strong>Decision:</strong> <span style="color: var(--color-green); font-weight: 700;">${data.iteration_2.decision}</span></p>
                                <p><strong>Metrics:</strong></p>
                                <ul style="list-style: none; padding: 0;">
                                    <li>‚Ä¢ Confidence avg: ${(data.iteration_2.metrics.confidence_avg * 100).toFixed(1)}%</li>
                                    <li>‚Ä¢ Divergence: ${data.iteration_2.metrics.divergence.toFixed(3)}</li>
                                </ul>
                                <p style="padding: 15px; background: rgba(0,255,136,0.1); border-left: 4px solid var(--color-green); border-radius: 5px; margin-top: 15px;">
                                    <strong>Rationale:</strong> ${data.iteration_2.rationale}
                                </p>
                                <p><strong>Gap Fixed:</strong> ${data.iteration_2.gap_fixed}</p>
                                ${data.iteration_2.retrieval_expansion ? `
                                    <p><strong>Retrieval Expansion:</strong></p>
                                    <ul>
                                        <li>New cases: ${data.iteration_2.retrieval_expansion.new_cases.join(', ')}</li>
                                        <li>Reason: ${data.iteration_2.retrieval_expansion.reason}</li>
                                    </ul>
                                ` : ''}
                            </div>
                        </div>
                    ` : ''}
                    
                    ${data.metrics && !data.iteration_1 ? `
                        <div class="substage-panel expanded">
                            <div class="substage-header">
                                <div class="substage-title">6.1 Input Metrics</div>
                                <span class="expand-icon">‚ñº</span>
                            </div>
                            <div class="substage-content">
                                <table class="data-table">
                                    <thead>
                                        <tr><th>Metric</th><th>Threshold</th><th>Actual</th><th>Status</th></tr>
                                    </thead>
                                    <tbody>
                                        ${data.metrics.map(m => `
                                            <tr>
                                                <td>${m.metric}</td>
                                                <td>${m.threshold}</td>
                                                <td>${m.actual}</td>
                                                <td><span style="color: ${m.status === 'PASS' ? 'var(--color-green)' : 'var(--color-pink)'};font-weight: 700;">${m.status}</span></td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                                <p style="padding: 15px; background: rgba(0,255,136,0.1); border-left: 4px solid var(--color-green); border-radius: 5px; margin-top: 15px;">
                                    <strong>Decision:</strong> ${data.decision}<br/>
                                    <strong>Rationale:</strong> ${data.rationale}
                                </p>
                            </div>
                        </div>
                    ` : ''}
                    
                    <button class="copy-btn" onclick="copyJSON('loop_controller')">üìã Copy JSON Output</button>
                </div>
            `;
        }

        function renderStep7() {
            const data = currentExampleData.synthesis;
            if (!data) return '';
            
            return `
                <div class="step-section" id="step7" data-step="7">
                    <div class="step-header-main">
                        <div class="step-title-main">
                            <span class="step-badge">STEP 7</span>
                            ‚ö° Synthesis
                        </div>
                    </div>
                    
                    <div class="substage-panel expanded">
                        <div class="substage-header">
                            <div class="substage-title">7.1 Synthesis Mode &amp; Weights</div>
                            <span class="expand-icon">‚ñº</span>
                        </div>
                        <div class="substage-content">
                            <p><strong>Mode:</strong> <span style="color: var(--color-cyan); font-weight: 700; text-transform: uppercase;">${data.mode}</span></p>
                            ${data.weights ? `
                                <table class="data-table" style="margin-top: 15px;">
                                    <thead>
                                        <tr><th>Expert</th><th>Weight</th><th>Confidence</th><th>Contribution</th></tr>
                                    </thead>
                                    <tbody>
                                        ${data.weights.map(w => `
                                            <tr>
                                                <td>${w.expert}</td>
                                                <td>${(w.weight * 100).toFixed(1)}%</td>
                                                <td>${(w.confidence * 100).toFixed(1)}%</td>
                                                <td>${w.contribution.toFixed(3)}</td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                                <p style="font-family: 'Courier New', monospace; color: var(--color-cyan); margin-top: 15px; padding: 10px; background: rgba(0,0,0,0.3); border-radius: 5px;">
                                    <strong>Formula:</strong> ${data.formula}
                                </p>
                            ` : ''}
                        </div>
                    </div>
                    
                    <div class="substage-panel expanded">
                        <div class="substage-header">
                            <div class="substage-title">7.2 Final Conclusion</div>
                            <span class="expand-icon">‚ñº</span>
                        </div>
                        <div class="substage-content">
                            <div style="padding: 25px; background: linear-gradient(135deg, rgba(0,255,136,0.15), rgba(0,212,255,0.15)); border: 3px solid var(--color-green); border-radius: 15px; text-align: center;">
                                <div style="font-size: 1.8rem; font-weight: 700; color: var(--color-green); margin-bottom: 15px;">
                                    ${data.final_conclusion}
                                </div>
                                <div class="gauge-container">
                                    <div class="gauge" style="background: conic-gradient(var(--color-green) ${data.final_confidence * 360}deg, transparent ${data.final_confidence * 360}deg); width: 150px; height: 150px;">
                                        <div class="gauge-value" style="font-size: 2rem;">${(data.final_confidence * 100).toFixed(1)}%</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    ${data.key_points ? `
                        <div class="substage-panel">
                            <div class="substage-header">
                                <div class="substage-title">7.3 Key Points</div>
                                <span class="expand-icon">‚ñº</span>
                            </div>
                            <div class="substage-content">
                                <ul style="list-style: none; padding: 0;">
                                    ${data.key_points.map(point => `
                                        <li style="padding: 12px; margin: 8px 0; background: rgba(0,212,255,0.05); border-left: 4px solid var(--color-cyan); border-radius: 5px;">
                                            ‚úì ${point}
                                        </li>
                                    `).join('')}
                                </ul>
                            </div>
                        </div>
                    ` : ''}
                    
                    ${data.caveats && data.caveats.length > 0 ? `
                        <div class="substage-panel">
                            <div class="substage-header">
                                <div class="substage-title">7.4 Caveats &amp; Exceptions</div>
                                <span class="expand-icon">‚ñº</span>
                            </div>
                            <div class="substage-content">
                                ${data.caveats.map(caveat => `
                                    <div style="padding: 15px; background: rgba(255,68,68,0.1); border-left: 4px solid ${caveat.severity === 'HIGH' ? '#ff4444' : caveat.severity === 'MEDIUM' ? 'var(--color-yellow)' : 'var(--color-orange)'}; border-radius: 5px; margin: 10px 0;">
                                        <strong style="color: var(--color-yellow);">‚ö†Ô∏è ${caveat.severity}</strong><br/>
                                        ${caveat.text}
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    ` : ''}
                    
                    ${data.sources ? `
                        <div class="substage-panel">
                            <div class="substage-header">
                                <div class="substage-title">7.5 Sources &amp; References</div>
                                <span class="expand-icon">‚ñº</span>
                            </div>
                            <div class="substage-content">
                                <table class="data-table">
                                    <thead>
                                        <tr><th>Type</th><th>ID</th><th>Title</th><th>Citations</th><th>Relevance</th></tr>
                                    </thead>
                                    <tbody>
                                        ${data.sources.map(s => `
                                            <tr>
                                                <td>${s.type === 'norm' ? 'üìñ' : s.type === 'precedent' ? '‚öñÔ∏è' : 'üìÑ'} ${s.type}</td>
                                                <td><strong>${s.id}</strong></td>
                                                <td>${s.title || 'N/A'}</td>
                                                <td>${s.citations}</td>
                                                <td>${(s.relevance * 100).toFixed(1)}%</td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    ` : ''}
                    
                    <button class="copy-btn" onclick="copyJSON('synthesis')">üìã Copy JSON Output</button>
                </div>
            `;
        }

        function renderStep8() {
            const data = currentExampleData.traceability;
            if (!data) return '';
            
            return `
                <div class="step-section" id="step8" data-step="8">
                    <div class="step-header-main">
                        <div class="step-title-main">
                            <span class="step-badge">STEP 8</span>
                            üìä Traceability, Audit &amp; Export
                        </div>
                    </div>
                    
                    <div class="substage-panel expanded">
                        <div class="substage-header">
                            <div class="substage-title">8.1 Execution Metadata</div>
                            <span class="expand-icon">‚ñº</span>
                        </div>
                        <div class="substage-content">
                            <table class="data-table">
                                <tr><td>Total Execution Time</td><td><strong>${data.execution_time_ms}ms</strong></td></tr>
                                <tr><td>Total Tokens</td><td><strong>${data.total_tokens.toLocaleString()}</strong></td></tr>
                            </table>
                        </div>
                    </div>
                    
                    ${data.model_versions ? `
                        <div class="substage-panel">
                            <div class="substage-header">
                                <div class="substage-title">8.2 Model Versions</div>
                                <span class="expand-icon">‚ñº</span>
                            </div>
                            <div class="substage-content">
                                <table class="data-table">
                                    ${Object.entries(data.model_versions).map(([key, value]) => `
                                        <tr>
                                            <td style="text-transform: capitalize;">${key.replace('_', ' ')}</td>
                                            <td><strong>${value}</strong></td>
                                        </tr>
                                    `).join('')}
                                </table>
                            </div>
                        </div>
                    ` : ''}
                    
                    ${data.compliance ? `
                        <div class="substage-panel">
                            <div class="substage-header">
                                <div class="substage-title">8.3 Compliance Audit</div>
                                <span class="expand-icon">‚ñº</span>
                            </div>
                            <div class="substage-content">
                                <table class="data-table">
                                    <thead>
                                        <tr><th>Feature</th><th>Standard</th><th>Status</th><th>Details</th></tr>
                                    </thead>
                                    <tbody>
                                        ${data.compliance.map(c => `
                                            <tr>
                                                <td>${c.feature}</td>
                                                <td>${c.standard}</td>
                                                <td><span style="color: ${c.status === 'compliant' ? 'var(--color-green)' : 'var(--color-pink)'};font-weight: 700;">${c.status}</span></td>
                                                <td>${c.details}</td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    ` : ''}
                    
                    ${data.feedback_history ? `
                        <div class="substage-panel">
                            <div class="substage-header">
                                <div class="substage-title">8.4 Feedback Integration (RLCF)</div>
                                <span class="expand-icon">‚ñº</span>
                            </div>
                            <div class="substage-content">
                                <table class="data-table">
                                    <thead>
                                        <tr><th>Date</th><th>Feedback</th><th>Impact</th></tr>
                                    </thead>
                                    <tbody>
                                        ${data.feedback_history.map(f => `
                                            <tr>
                                                <td>${f.date}</td>
                                                <td>${f.feedback}</td>
                                                <td style="color: var(--color-green);">${f.impact}</td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    ` : ''}
                    
                    ${currentExampleData.export ? `
                        <div class="substage-panel expanded">
                            <div class="substage-header">
                                <div class="substage-title">8.5 Export Options</div>
                                <span class="expand-icon">‚ñº</span>
                            </div>
                            <div class="substage-content">
                                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                                    ${currentExampleData.export.available_formats.map(format => `
                                        <button class="copy-btn" onclick="alert('Export ${format} not implemented in demo')">
                                            üì• Export ${format}
                                        </button>
                                    `).join('')}
                                </div>
                            </div>
                        </div>
                    ` : ''}
                </div>
            `;
        }

        function copyJSON(section) {
            const data = currentExampleData[section];
            const json = JSON.stringify(data, null, 2);
            navigator.clipboard.writeText(json).then(() => {
                alert('JSON copied to clipboard!');
            });
        }

        function startSimulation() {
            if (!selectedExample) return;
            
            if (simulationPaused) {
                // Resume
                simulationPaused = false;
                simulationRunning = true;
                startTimer();
                continueSimulation();
            } else {
                // Start new
                simulationRunning = true;
                simulationPaused = false;
                currentStep = 0;
                elapsedTime = 0;
                
                // Show sections
                document.getElementById('flowDiagram').classList.add('visible');
                document.getElementById('progressSection').classList.add('visible');
                document.getElementById('metricsDashboard').classList.add('visible');
                
                // Start timer
                startTimer();
                
                // Run simulation
                runSimulation();
            }

            // Update buttons
            document.getElementById('startBtn').disabled = true;
            document.getElementById('pauseBtn').disabled = false;
        }

        function pauseSimulation() {
            if (!simulationRunning) return;
            
            simulationPaused = true;
            simulationRunning = false;
            stopTimer();
            
            // Clear pending timeouts
            stepTimeouts.forEach(timeout => clearTimeout(timeout));
            stepTimeouts = [];
            
            // Update buttons
            document.getElementById('startBtn').disabled = false;
            document.getElementById('pauseBtn').disabled = true;
        }

        function resetSimulation() {
            simulationRunning = false;
            simulationPaused = false;
            currentStep = 0;
            elapsedTime = 0;
            
            stopTimer();
            
            // Clear timeouts
            stepTimeouts.forEach(timeout => clearTimeout(timeout));
            stepTimeouts = [];
            
            // Hide sections
            document.getElementById('flowDiagram').classList.remove('visible');
            document.getElementById('progressSection').classList.remove('visible');
            document.getElementById('metricsDashboard').classList.remove('visible');
            document.getElementById('finalResult').classList.remove('visible');
            document.getElementById('agentsContainer').classList.remove('visible');
            document.getElementById('loopIndicator').classList.remove('visible');
            document.getElementById('expertsPanel').classList.remove('visible');
            
            // Reset progress
            document.getElementById('progressBar').style.width = '0%';
            
            // Clear step details
            document.getElementById('stepDetails').innerHTML = '';
            
            // Reset flow steps
            document.querySelectorAll('.flow-step').forEach(step => {
                step.classList.remove('active', 'complete');
            });
            
            // Reset metrics
            document.getElementById('metricLatency').innerHTML = '0<span class="metric-unit">ms</span>';
            document.getElementById('metricIterations').textContent = '0';
            document.getElementById('metricConfidence').innerHTML = '0<span class="metric-unit">%</span>';
            document.getElementById('metricTokens').textContent = '0';
            
            // Reset agents
            ['kg', 'api', 'vector'].forEach(agent => {
                document.getElementById(`${agent}Progress`).style.background = 'conic-gradient(var(--color-green) 0deg, transparent 0deg)';
                document.getElementById(`${agent}Value`).textContent = '0%';
            });
            
            // Update buttons
            document.getElementById('startBtn').disabled = false;
            document.getElementById('pauseBtn').disabled = true;
        }

        function skipToEnd() {
            if (!selectedExample) return;
            
            // Stop current simulation
            pauseSimulation();
            
            // Complete all steps instantly
            currentStep = pipelineSteps.length;
            
            // Update progress
            document.getElementById('progressBar').style.width = '100%';
            
            // Mark all steps complete
            document.querySelectorAll('.flow-step').forEach(step => {
                step.classList.add('complete');
                step.classList.remove('active');
            });
            
            // Update metrics
            updateMetrics(true);
            
            // Show final result
            showFinalResult();
            
            // Stop timer
            stopTimer();
            
            // Update buttons
            document.getElementById('startBtn').disabled = true;
            document.getElementById('pauseBtn').disabled = true;
        }

        function runSimulation() {
            const stepDuration = (selectedExample.latency / pipelineSteps.length) / simulationSpeed;
            
            pipelineSteps.forEach((step, index) => {
                const timeout = setTimeout(() => {
                    if (!simulationRunning) return;
                    
                    currentStep = index + 1;
                    processStep(step, index);
                    
                    // Show parallel agents during step 4
                    if (index === 3) {
                        showParallelAgents();
                    }
                    
                    // Show experts during step 5
                    if (index === 4) {
                        showExpertsPanel();
                    }
                    
                    // Show loop indicator for examples with multiple iterations
                    if (index === 4 && selectedExample.iterazioni > 1) {
                        showLoopIndicator();
                    }
                    
                    // Update progress
                    const progress = ((index + 1) / pipelineSteps.length) * 100;
                    document.getElementById('progressBar').style.width = `${progress}%`;
                    
                    // Update metrics gradually
                    updateMetrics(false, index + 1);
                    
                    // If last step, show final result
                    if (index === pipelineSteps.length - 1) {
                        setTimeout(() => {
                            if (simulationRunning) {
                                showFinalResult();
                                stopTimer();
                                document.getElementById('startBtn').disabled = true;
                                document.getElementById('pauseBtn').disabled = true;
                                
                                // Continue with next example in autoplay mode
                                if (autoplayMode) {
                                    setTimeout(() => {
                                        const nextId = (selectedExample.numero % examples.length) + 1;
                                        selectExample(nextId);
                                        setTimeout(startSimulation, 2000);
                                    }, 3000);
                                }
                            }
                        }, stepDuration * 0.8 / simulationSpeed);
                    }
                }, stepDuration * index);
                
                stepTimeouts.push(timeout);
            });
        }

        function showParallelAgents() {
            const container = document.getElementById('agentsContainer');
            container.classList.add('visible');
            
            // Animate agents progress
            const agents = ['kg', 'api', 'vector'];
            agents.forEach((agent, index) => {
                let progress = 0;
                const interval = setInterval(() => {
                    progress += 5;
                    if (progress > 100) {
                        progress = 100;
                        clearInterval(interval);
                    }
                    
                    const progressCircle = document.getElementById(`${agent}Progress`);
                    const progressValue = document.getElementById(`${agent}Value`);
                    const status = document.getElementById(`${agent}Status`);
                    
                    progressCircle.style.background = `conic-gradient(var(--color-green) ${progress * 3.6}deg, transparent 0deg)`;
                    progressValue.textContent = progress + '%';
                    
                    if (progress === 100) {
                        status.textContent = 'Complete ‚úì';
                        status.style.color = 'var(--color-green)';
                    }
                }, 50 * (index + 1));
            });
        }

        function showLoopIndicator() {
            const indicator = document.getElementById('loopIndicator');
            const reason = document.getElementById('loopReason');
            
            indicator.classList.add('visible');
            
            if (selectedExample.numero === 5) {
                reason.innerHTML = `
                    <strong>Iterazione 1 ‚Üí 2:</strong> Divergenza iniziale rilevata (0.16). 
                    Gap: onerosit√† implicita o esplicita? Sistema ha richiesto retrieval espanso 
                    di giurisprudenza consolidata per raggiungere convergenza (divergenza finale: 0.07).
                `;
            } else if (selectedExample.numero === 8) {
                reason.innerHTML = `
                    <strong>Iterazione 1 ‚Üí 2:</strong> Materia non regolata espressamente. 
                    Sistema ha espanso ricerca su dibattito UE e AI Act 2024 per colmare lacuna ordinamento.
                `;
            }
        }

        function showExpertsPanel() {
            const panel = document.getElementById('expertsPanel');
            const grid = document.getElementById('expertsGrid');
            
            panel.classList.add('visible');
            
            grid.innerHTML = selectedExample.experts.map((expert, index) => {
                const confidence = Math.round(selectedExample.confidence * 100 - (index * 5));
                return `
                    <div class="expert-card" style="animation-delay: ${index * 0.2}s">
                        <div class="expert-header">
                            <span class="expert-name">${expert}</span>
                            <span class="expert-confidence">${confidence}%</span>
                        </div>
                        <div class="expert-reasoning">
                            Analisi dettagliata delle norme applicabili, considerando 
                            interpretazione ${expert.toLowerCase()} e coordinamento sistematico 
                            con principi costituzionali e giurisprudenza consolidata.
                        </div>
                    </div>
                `;
            }).join('');
        }

        function toggleAutoplay() {
            autoplayMode = !autoplayMode;
            const btn = document.getElementById('autoplayBtn');
            
            if (autoplayMode) {
                btn.style.background = 'linear-gradient(135deg, var(--color-green), #00cc70)';
                btn.textContent = '‚úì Auto ON';
                if (!simulationRunning && selectedExample) {
                    startSimulation();
                }
            } else {
                btn.style.background = 'linear-gradient(135deg, var(--color-cyan), #0090ff)';
                btn.textContent = 'üé¨ Auto';
            }
        }

        function continueSimulation() {
            const stepDuration = selectedExample.latency / pipelineSteps.length;
            const remainingSteps = pipelineSteps.slice(currentStep);
            
            remainingSteps.forEach((step, index) => {
                const timeout = setTimeout(() => {
                    if (!simulationRunning) return;
                    
                    currentStep++;
                    processStep(step, currentStep - 1);
                    
                    // Update progress
                    const progress = (currentStep / pipelineSteps.length) * 100;
                    document.getElementById('progressBar').style.width = `${progress}%`;
                    
                    // Update metrics
                    updateMetrics(false, currentStep);
                    
                    // If last step
                    if (currentStep === pipelineSteps.length) {
                        setTimeout(() => {
                            if (simulationRunning) {
                                showFinalResult();
                                stopTimer();
                                document.getElementById('startBtn').disabled = true;
                                document.getElementById('pauseBtn').disabled = true;
                            }
                        }, stepDuration * 0.8);
                    }
                }, stepDuration * index);
                
                stepTimeouts.push(timeout);
            });
        }

        function processStep(step, index) {
            // Update flow step
            const flowStep = document.querySelector(`.flow-step[data-step="${step.numero}"]`);
            flowStep.classList.add('active');
            
            // Create step container
            const container = document.createElement('div');
            container.className = 'step-container visible';
            container.innerHTML = `
                <div class="step-header">
                    <div class="step-title">${step.emoji} ${step.nome}</div>
                    <div class="step-status processing">‚ö° Processing...</div>
                </div>
                <div class="step-description">${step.descrizione}</div>
                <ul class="substep-list" id="substeps-${step.numero}"></ul>
            `;
            document.getElementById('stepDetails').appendChild(container);
            
            // Animate substeps
            const substepList = document.getElementById(`substeps-${step.numero}`);
            step.substeps.forEach((substep, subIndex) => {
                setTimeout(() => {
                    const li = document.createElement('li');
                    li.className = 'substep-item';
                    li.textContent = `‚ñ∏ ${substep}`;
                    li.style.animationDelay = `${subIndex * 0.1}s`;
                    substepList.appendChild(li);
                }, subIndex * 200);
            });
            
            // Mark step complete after processing
            setTimeout(() => {
                flowStep.classList.remove('active');
                flowStep.classList.add('complete');
                const status = container.querySelector('.step-status');
                status.className = 'step-status complete';
                status.textContent = '‚úì Complete';
            }, (selectedExample.latency / pipelineSteps.length) * 0.8);
        }

        function updateMetrics(final, currentStepNum = 0) {
            if (final) {
                document.getElementById('metricLatency').innerHTML = 
                    `${selectedExample.latency.toLocaleString()}<span class="metric-unit">ms</span>`;
                document.getElementById('metricIterations').textContent = selectedExample.iterazioni;
                document.getElementById('metricConfidence').innerHTML = 
                    `${(selectedExample.confidence * 100).toFixed(1)}<span class="metric-unit">%</span>`;
                document.getElementById('metricTokens').textContent = selectedExample.tokens.toLocaleString();
            } else {
                const progress = currentStepNum / pipelineSteps.length;
                document.getElementById('metricLatency').innerHTML = 
                    `${Math.round(selectedExample.latency * progress).toLocaleString()}<span class="metric-unit">ms</span>`;
                document.getElementById('metricIterations').textContent = 
                    currentStepNum >= pipelineSteps.length - 1 ? selectedExample.iterazioni : 0;
                document.getElementById('metricConfidence').innerHTML = 
                    `${(selectedExample.confidence * 100 * progress).toFixed(1)}<span class="metric-unit">%</span>`;
                document.getElementById('metricTokens').textContent = 
                    Math.round(selectedExample.tokens * progress).toLocaleString();
            }
        }

        function showFinalResult() {
            const result = document.getElementById('finalResult');
            result.classList.add('visible');
            
            // Scroll to result
            result.scrollIntoView({ behavior: 'smooth', block: 'start' });
            
            document.getElementById('resultConclusion').textContent = selectedExample.conclusion;
            
            // Experts
            const expertsList = document.getElementById('expertsList');
            expertsList.innerHTML = selectedExample.experts.map((expert, index) => 
                `<span class="expert-badge" style="animation-delay: ${index * 0.1}s">${expert}</span>`
            ).join('');
            
            // Key points
            const keyPointsList = document.getElementById('keyPointsList');
            keyPointsList.innerHTML = selectedExample.key_points.map((point, index) => 
                `<li class="key-point" style="animation-delay: ${index * 0.15}s">‚úì ${point}</li>`
            ).join('');
            
            // Metadata
            const metadata = document.getElementById('resultMetadata');
            metadata.innerHTML = `
                <div class="metadata-item">
                    <div class="metadata-label">Confidence</div>
                    <div class="metadata-value">${(selectedExample.confidence * 100).toFixed(1)}%</div>
                </div>
                <div class="metadata-item">
                    <div class="metadata-label">Latency</div>
                    <div class="metadata-value">${selectedExample.latency}ms</div>
                </div>
                <div class="metadata-item">
                    <div class="metadata-label">Iterazioni</div>
                    <div class="metadata-value">${selectedExample.iterazioni}</div>
                </div>
                <div class="metadata-item">
                    <div class="metadata-label">Token</div>
                    <div class="metadata-value">${selectedExample.tokens.toLocaleString()}</div>
                </div>
                <div class="metadata-item">
                    <div class="metadata-label">Entit√†</div>
                    <div class="metadata-value">${selectedExample.entities}</div>
                </div>
                <div class="metadata-item">
                    <div class="metadata-label">Concetti</div>
                    <div class="metadata-value">${selectedExample.concepts}</div>
                </div>
            `;
        }

        function startTimer() {
            startTime = Date.now() - elapsedTime;
            document.getElementById('timer').classList.add('active');
            timerInterval = setInterval(updateTimer, 10);
        }

        function stopTimer() {
            clearInterval(timerInterval);
            document.getElementById('timer').classList.remove('active');
        }

        function updateTimer() {
            elapsedTime = Date.now() - startTime;
            const minutes = Math.floor(elapsedTime / 60000);
            const seconds = Math.floor((elapsedTime % 60000) / 1000);
            const milliseconds = elapsedTime % 1000;
            
            document.getElementById('timer').textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}.${milliseconds.toString().padStart(3, '0')}`;
        }

        // Initialize app
        init();
    </script>
</body>
</html>