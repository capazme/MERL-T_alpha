# MERL-T Weight Configuration
# ============================
#
# Configurazione unificata di tutti i pesi nel sistema.
#
# Ogni peso può essere:
#   - default: valore di default
#   - bounds: [min, max] per learning
#   - learnable: se può essere appreso via RLCF
#   - learning_rate: rate di apprendimento
#
# Fondamento teorico: Preleggi (art. 12-14 disp. prel. c.c.)

version: "2.0"
schema_version: "1.0"
last_updated: "2025-12-20"

# === RETRIEVAL WEIGHTS ===
# Pesi per hybrid retrieval (vector + graph)
retrieval:
  # Alpha: bilancio vector similarity vs graph score
  # alpha = 0.7 → 70% semantico, 30% strutturale
  alpha:
    default: 0.7
    bounds: [0.3, 0.9]
    learnable: true
    learning_rate: 0.01

  # Over-retrieve per re-ranking
  over_retrieve_factor: 3

  # Massimi hop nel grafo
  max_graph_hops: 3

  # Score default quando non c'e' path
  default_graph_score: 0.5

# === EXPERT TRAVERSAL WEIGHTS ===
# Pesi di traversal per i 4 Expert (mappati su Preleggi)
expert_traversal:

  # LiteralExpert: Interpretazione letterale
  # Art. 12, I disp. prel. c.c. - "significato proprio delle parole"
  LiteralExpert:
    contiene:
      default: 1.0
      bounds: [0.5, 1.0]
      learnable: true
    disciplina:
      default: 0.95
      bounds: [0.5, 1.0]
      learnable: true
    definisce:
      default: 0.95
      bounds: [0.5, 1.0]
      learnable: true
    modifica:
      default: 0.85
      bounds: [0.5, 1.0]
      learnable: true
    abroga:
      default: 0.80
      bounds: [0.5, 1.0]
      learnable: true
    rinvia:
      default: 0.75
      bounds: [0.5, 1.0]
      learnable: true
    relazione_concettuale:
      default: 0.60
      bounds: [0.3, 0.9]
      learnable: true
    interpreta:
      default: 0.50
      bounds: [0.3, 0.8]
      learnable: true
    applica:
      default: 0.45
      bounds: [0.3, 0.8]
      learnable: true
    default: 0.50

  # SystemicExpert: Interpretazione sistematica
  # Art. 12, I disp. prel. c.c. - "connessione di esse"
  # Include anche interpretazione storica via MODIFICA/SOSTITUISCE
  SystemicExpert:
    gerarchia_kelseniana:
      default: 1.0
      bounds: [0.5, 1.0]
      learnable: true
    attuazione:
      default: 0.95
      bounds: [0.5, 1.0]
      learnable: true
    delega:
      default: 0.90
      bounds: [0.5, 1.0]
      learnable: true
    modifica:
      default: 0.90
      bounds: [0.5, 1.0]
      learnable: true
    abroga:
      default: 0.85
      bounds: [0.5, 1.0]
      learnable: true
    deroga:
      default: 0.90
      bounds: [0.5, 1.0]
      learnable: true
    contiene:
      default: 0.85
      bounds: [0.5, 1.0]
      learnable: true
    disciplina:
      default: 0.85
      bounds: [0.5, 1.0]
      learnable: true
    relazione_concettuale:
      default: 0.75
      bounds: [0.5, 1.0]
      learnable: true
    specifica:
      default: 0.80
      bounds: [0.5, 1.0]
      learnable: true
    interpreta:
      default: 0.70
      bounds: [0.5, 1.0]
      learnable: true
    default: 0.50

  # PrinciplesExpert: Interpretazione teleologica/principi
  # Art. 12, II disp. prel. c.c. - "intenzione del legislatore"
  PrinciplesExpert:
    relazione_concettuale:
      default: 1.0
      bounds: [0.5, 1.0]
      learnable: true
    disciplina:
      default: 0.90
      bounds: [0.5, 1.0]
      learnable: true
    attuazione:
      default: 0.95
      bounds: [0.5, 1.0]
      learnable: true
    deroga:
      default: 0.95
      bounds: [0.5, 1.0]
      learnable: true
    bilancia:
      default: 0.95
      bounds: [0.5, 1.0]
      learnable: true
    gerarchia_kelseniana:
      default: 0.90
      bounds: [0.5, 1.0]
      learnable: true
    interpreta:
      default: 0.85
      bounds: [0.5, 1.0]
      learnable: true
    applica:
      default: 0.80
      bounds: [0.5, 1.0]
      learnable: true
    conferma:
      default: 0.75
      bounds: [0.5, 1.0]
      learnable: true
    contiene:
      default: 0.60
      bounds: [0.3, 0.9]
      learnable: true
    default: 0.50

  # PrecedentExpert: Interpretazione giurisprudenziale
  # Prassi applicativa - art. 14 disp. prel. c.c.
  PrecedentExpert:
    interpreta:
      default: 1.0
      bounds: [0.5, 1.0]
      learnable: true
    applica:
      default: 1.0
      bounds: [0.5, 1.0]
      learnable: true
    conferma:
      default: 0.95
      bounds: [0.5, 1.0]
      learnable: true
    overrules:
      default: 0.95
      bounds: [0.5, 1.0]
      learnable: true
    distinguishes:
      default: 0.90
      bounds: [0.5, 1.0]
      learnable: true
    cita:
      default: 0.85
      bounds: [0.5, 1.0]
      learnable: true
    disciplina:
      default: 0.75
      bounds: [0.5, 1.0]
      learnable: true
    contiene:
      default: 0.70
      bounds: [0.5, 1.0]
      learnable: true
    relazione_concettuale:
      default: 0.70
      bounds: [0.5, 1.0]
      learnable: true
    default: 0.50

# === RLCF AUTHORITY WEIGHTS ===
# Pesi per il calcolo dell'authority dei feedback
# Formula: A_u(t) = alpha * B_u + beta * T_u(t-1) + gamma * P_u(t)
rlcf:
  baseline_credentials:
    default: 0.4
    bounds: [0.1, 0.6]
    learnable: true
    learning_rate: 0.01

  track_record:
    default: 0.4
    bounds: [0.2, 0.7]
    learnable: true
    learning_rate: 0.01

  recent_performance:
    default: 0.2
    bounds: [0.1, 0.4]
    learnable: true
    learning_rate: 0.01

  # Lambda per exponential smoothing del track record
  track_record_update_factor:
    default: 0.05
    bounds: [0.01, 0.2]
    learnable: true
    learning_rate: 0.005

# === GATING NETWORK WEIGHTS ===
# Pesi per attivazione Expert (MoE-style)
gating:
  # Pesi prior per ogni Expert (devono sommare a 1.0)
  expert_priors:
    LiteralExpert:
      default: 0.25
      bounds: [0.1, 0.5]
      learnable: true
    SystemicExpert:
      default: 0.25
      bounds: [0.1, 0.5]
      learnable: true
    PrinciplesExpert:
      default: 0.25
      bounds: [0.1, 0.5]
      learnable: true
    PrecedentExpert:
      default: 0.25
      bounds: [0.1, 0.5]
      learnable: true

  # Modificatori basati su tipo query
  # Moltiplicano i prior per specializzare gli Expert
  query_type_modifiers:
    definitorio:
      LiteralExpert: 1.5
      SystemicExpert: 0.8
      PrinciplesExpert: 0.9
      PrecedentExpert: 0.8
    interpretativo:
      LiteralExpert: 0.9
      SystemicExpert: 1.1
      PrinciplesExpert: 1.3
      PrecedentExpert: 1.2
    applicativo:
      LiteralExpert: 0.8
      SystemicExpert: 1.1
      PrinciplesExpert: 0.9
      PrecedentExpert: 1.5
    storico:
      LiteralExpert: 0.7
      SystemicExpert: 1.5
      PrinciplesExpert: 1.0
      PrecedentExpert: 1.0

# === EXPERIMENT SETTINGS ===
# Configurazione per A/B testing
experiments:
  enabled: true
  default_split_ratio: 0.5
  min_samples_for_significance: 100
  significance_threshold: 0.05  # p-value

# === NOTES ===
# Per modificare questi pesi:
# 1. Editing diretto di questo file (restart richiesto)
# 2. Override runtime via WeightStore.update_runtime()
# 3. Persistenza database via WeightStore.save_weights()
# 4. Learning automatico via WeightLearner (RLCF feedback)
