# =============================================================================
# MERL-T Production Environment Variables - Neo4j Knowledge Graph
# =============================================================================
#
# This file contains production-specific environment variables for Neo4j deployment.
#
# IMPORTANT SECURITY NOTES:
# 1. Copy this file to `.env.production` and fill in actual values
# 2. NEVER commit `.env.production` to version control
# 3. Change all default passwords immediately after first deployment
# 4. Use strong passwords (20+ characters, mixed case, numbers, symbols)
# 5. Rotate passwords every 90 days
#
# Usage:
#   cp .env.production.template .env.production
#   # Edit .env.production with actual values
#   docker-compose --env-file .env.production -f infrastructure/docker/neo4j-production.yml up -d
#
# =============================================================================

# =============================================================================
# NEO4J CORE CONFIGURATION
# =============================================================================

# Neo4j version (use specific version for production, not latest)
NEO4J_VERSION=5.13-community

# Database name (default: merl-t-kg)
NEO4J_DATABASE_NAME=merl-t-kg

# =============================================================================
# AUTHENTICATION & SECURITY
# =============================================================================

# Neo4j authentication credentials
# Format: username/password
# DEFAULT: neo4j/CHANGE_ME_IMMEDIATELY
# PRODUCTION: Generate strong password with: openssl rand -base64 32
NEO4J_AUTH=neo4j/CHANGE_ME_IMMEDIATELY

# Accept Neo4j license agreement (required for Neo4j >= 5.0)
NEO4J_ACCEPT_LICENSE_AGREEMENT=yes

# Security logging (audit trail for compliance)
NEO4J_SECURITY_LOGS=true

# =============================================================================
# SSL/TLS CONFIGURATION
# =============================================================================

# Enable SSL/TLS for Bolt connections (recommended for production)
# Requires SSL certificates in ${NEO4J_SSL_DIR}/bolt.key and bolt.crt
# Generate certificates with: infrastructure/security/generate_ssl_certs.sh
NEO4J_SSL_ENABLED=false

# SSL certificates directory (absolute path)
NEO4J_SSL_DIR=/Users/gpuzio/Desktop/CODE/MERL-T_alpha/infrastructure/security/neo4j/ssl

# =============================================================================
# NETWORK PORTS
# =============================================================================

# HTTP Browser UI port (restrict to localhost: 127.0.0.1:7474)
# For production, only expose internally or via reverse proxy
NEO4J_BROWSER_PORT=7474

# Bolt protocol port (for application connections)
NEO4J_BOLT_PORT=7687

# =============================================================================
# DATA DIRECTORIES (Persistent storage)
# =============================================================================

# Data directory (graph database files)
# Estimated size: 2GB for 5,000 articles (100,000 nodes + 500,000 relationships)
NEO4J_DATA_DIR=/Users/gpuzio/Desktop/CODE/MERL-T_alpha/data/neo4j

# Logs directory (query logs, debug logs, security audit logs)
# Log retention: 7 days, max 1GB per file
NEO4J_LOGS_DIR=/Users/gpuzio/Desktop/CODE/MERL-T_alpha/logs/neo4j

# Plugins directory (APOC, GDS, etc.)
NEO4J_PLUGINS_DIR=/Users/gpuzio/Desktop/CODE/MERL-T_alpha/plugins/neo4j

# Import directory (for bulk CSV imports via neo4j-admin)
NEO4J_IMPORT_DIR=/Users/gpuzio/Desktop/CODE/MERL-T_alpha/import/neo4j

# Backup directory (for neo4j-admin dumps)
# Retention: 30 days (configure in backup script)
# Estimated size: 500MB per backup (compressed)
NEO4J_BACKUP_DIR=/Users/gpuzio/Desktop/CODE/MERL-T_alpha/backups/neo4j

# =============================================================================
# QUERY LOGGING & MONITORING
# =============================================================================

# Enable query logging (log slow queries for performance analysis)
NEO4J_QUERY_LOGS=true

# Query logging threshold (log queries slower than this duration)
# Recommended: 1s for production (adjust based on p95 latency)
NEO4J_QUERY_THRESHOLD=1s

# General log level (INFO for production, DEBUG for troubleshooting)
# Options: ERROR, WARN, INFO, DEBUG
NEO4J_LOG_LEVEL=INFO

# HTTP log level (browser UI requests)
# Options: ERROR, WARN, INFO, DEBUG
NEO4J_HTTP_LOG_LEVEL=WARN

# =============================================================================
# METRICS & OBSERVABILITY
# =============================================================================

# Enable Prometheus metrics (for monitoring dashboard)
# Metrics endpoint: http://localhost:2004/metrics
NEO4J_METRICS_ENABLED=true

# =============================================================================
# MEMORY TUNING (Production settings for 5,000+ articles)
# =============================================================================

# Heap size: 4GB (stores transaction state, query execution)
# Rule of thumb: 50% of available RAM
# Adjust based on concurrent query load:
#   - 4GB: 50-100 concurrent users
#   - 8GB: 100-200 concurrent users
#   - 16GB: 200+ concurrent users
NEO4J_HEAP_SIZE=4G

# Page cache size: 4GB (caches graph data for fast access)
# Rule of thumb: 50% of available RAM
# For 100,000 nodes + 500,000 rels: ~2GB minimum, 4GB recommended
# Increase if disk I/O is bottleneck (check Grafana dashboard)
NEO4J_PAGE_CACHE_SIZE=4G

# =============================================================================
# CONNECTION POOLING
# =============================================================================

# Maximum Bolt connections (concurrent clients)
# Default: 100
# Adjust based on application connection pool size:
#   - Backend orchestration: 50 connections (max_pool_size in neo4j_connection.py)
#   - KG enrichment service: 20 connections
#   - Admin tools: 10 connections
#   - Buffer: 20 connections
#   Total: 100 connections
NEO4J_MAX_CONNECTIONS=100

# Minimum Bolt thread pool size (idle threads)
NEO4J_MIN_THREADS=5

# =============================================================================
# TRANSACTION TIMEOUTS
# =============================================================================

# Transaction timeout (max duration for a single transaction)
# Default: 5 minutes (suitable for long-running imports)
# Reduce to 1m for production queries if needed
NEO4J_TRANSACTION_TIMEOUT=5m

# Connection timeout (max time to establish connection)
NEO4J_CONNECTION_TIMEOUT=30s

# =============================================================================
# BACKUP CONFIGURATION
# =============================================================================

# Backup retention days (delete backups older than this)
# Recommended: 30 days for compliance, 7 days for development
NEO4J_BACKUP_RETENTION_DAYS=30

# Backup schedule (cron expression)
# Default: 3:00 AM daily
# Format: minute hour day month weekday
NEO4J_BACKUP_CRON="0 3 * * *"

# Backup notification email (send alerts on backup failure)
# Leave empty to disable email notifications
NEO4J_BACKUP_EMAIL=""

# =============================================================================
# PERFORMANCE TUNING
# =============================================================================

# Query cache size (number of compiled queries to cache)
# Default: 1000
# Increase if same queries are executed repeatedly
NEO4J_QUERY_CACHE_SIZE=1000

# Checkpoint interval (write to disk frequency)
# Default: 15 minutes
# Reduce for higher durability, increase for better write performance
NEO4J_CHECKPOINT_INTERVAL=15m

# =============================================================================
# DEVELOPMENT VS PRODUCTION
# =============================================================================

# Environment name (used in logging and monitoring)
ENVIRONMENT=production

# Application name (for service discovery)
APP_NAME=merl-t-kg

# =============================================================================
# OPTIONAL: CLOUD BACKUP INTEGRATION
# =============================================================================

# Uncomment and configure for cloud backup storage (AWS S3 / Azure Blob / GCS)

# AWS S3 Configuration (for backup uploads)
# AWS_REGION=eu-west-1
# AWS_S3_BACKUP_BUCKET=merl-t-neo4j-backups
# AWS_ACCESS_KEY_ID=YOUR_ACCESS_KEY
# AWS_SECRET_ACCESS_KEY=YOUR_SECRET_KEY

# Azure Blob Storage Configuration
# AZURE_STORAGE_ACCOUNT=merltstorageaccount
# AZURE_STORAGE_CONTAINER=neo4j-backups
# AZURE_STORAGE_SAS_TOKEN=YOUR_SAS_TOKEN

# Google Cloud Storage Configuration
# GCS_BACKUP_BUCKET=merl-t-neo4j-backups
# GCS_SERVICE_ACCOUNT_KEY=/path/to/service-account-key.json

# =============================================================================
# OPTIONAL: ADVANCED CONFIGURATION
# =============================================================================

# Enable experimental features (use with caution in production)
# NEO4J_dbms_experimental_features_enabled=false

# JVM garbage collection tuning (advanced users only)
# NEO4J_server_jvm_additional=-XX:+UseG1GC -XX:MaxGCPauseMillis=200

# Network interface binding (default: 0.0.0.0 - all interfaces)
# For security, bind only to specific IP (e.g., 127.0.0.1 for localhost)
# NEO4J_dbms_connector_bolt_listen__address=0.0.0.0:7687
# NEO4J_dbms_connector_http_listen__address=0.0.0.0:7474

# =============================================================================
# END OF CONFIGURATION
# =============================================================================
